<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">AndroGov | اللجان المنبثقة</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brandRed: '#FB4747',
                        brandBlue: '#4267B2',
                        brandDark: '#1E293B',
                        brandGray: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Tajawal', 'Inter', 'sans-serif'],
                        en: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
        }
        /* تأثير البطاقات غير الفعالة */
        .committee-inactive {
            filter: grayscale(1);
            opacity: 0.6;
            cursor: not-allowed;
            border-style: dashed;
        }
        /* Wizard Steps */
        .step-active { @apply border-brandBlue text-brandBlue; }
        .step-completed { @apply border-green-500 text-green-500; }
        .step-inactive { @apply border-slate-200 text-slate-400; }
    </style>
</head>
<body class="bg-brandGray dark:bg-slate-900 text-slate-800 dark:text-slate-100 font-sans transition-colors duration-300">

    <div id="sidebar-container" class="no-print"></div>
    
    <div class="main-content-wrapper md:mr-72 transition-all duration-300 flex flex-col min-h-screen">
        <div id="header-container" class="no-print"></div>

        <main class="p-6 space-y-6">
            
            <!-- 1. بطاقات اللجان (Status Overview) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <!-- Audit Committee (Active) -->
                <div onclick="selectCommittee('audit')" class="bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-md border-r-4 border-brandBlue relative overflow-hidden group cursor-pointer hover:shadow-lg transition">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 bg-blue-50 dark:bg-blue-900/30 text-brandBlue rounded-xl flex items-center justify-center text-2xl group-hover:scale-110 transition-transform">
                            <i class="fa-solid fa-magnifying-glass-chart"></i>
                        </div>
                        <span class="bg-green-100 text-green-700 text-[10px] px-2 py-1 rounded-full font-bold flex items-center gap-1">
                            <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> نشطة
                        </span>
                    </div>
                    <h3 class="font-bold text-lg mb-1">لجنة المراجعة</h3>
                    <p class="text-xs text-slate-500 mb-4">الدورة الحالية (2025-2028)</p>
                    
                    <!-- Members Preview -->
                    <div class="space-y-2 border-t border-slate-100 dark:border-slate-700 pt-3">
                        <div class="flex items-center gap-2 text-xs">
                            <img src="https://ui-avatars.com/api/?name=M&background=random" class="w-5 h-5 rounded-full">
                            <span class="font-bold">محمد بن منصور العنزي (رئيس)</span>
                        </div>
                        <div class="flex items-center gap-2 text-xs text-slate-500">
                            <span class="px-1">+2 أعضاء</span> | <span class="text-brandBlue font-bold">أمين السر: أنت</span>
                        </div>
                    </div>
                </div>

                <!-- Nomination Committee (Inactive) -->
                <div class="bg-slate-50 dark:bg-slate-800/50 p-6 rounded-3xl border border-slate-200 dark:border-slate-700 committee-inactive relative">
                    <div class="absolute inset-0 z-10 flex items-center justify-center">
                        <span class="bg-slate-200 text-slate-600 px-3 py-1 rounded-lg text-xs font-bold shadow-sm transform -rotate-12">غير مفعلة / لم تشكل</span>
                    </div>
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 bg-slate-200 text-slate-500 rounded-xl flex items-center justify-center text-2xl">
                            <i class="fa-solid fa-users-gear"></i>
                        </div>
                    </div>
                    <h3 class="font-bold text-lg mb-1 text-slate-500">المكافآت والترشيحات</h3>
                    <p class="text-xs text-slate-400">بانتظار قرار المجلس</p>
                </div>

                <!-- Executive Committee (Inactive) -->
                <div class="bg-slate-50 dark:bg-slate-800/50 p-6 rounded-3xl border border-slate-200 dark:border-slate-700 committee-inactive relative">
                    <div class="absolute inset-0 z-10 flex items-center justify-center">
                        <span class="bg-slate-200 text-slate-600 px-3 py-1 rounded-lg text-xs font-bold shadow-sm transform -rotate-12">غير مفعلة / لم تشكل</span>
                    </div>
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 bg-slate-200 text-slate-500 rounded-xl flex items-center justify-center text-2xl">
                            <i class="fa-solid fa-rocket"></i>
                        </div>
                    </div>
                    <h3 class="font-bold text-lg mb-1 text-slate-500">اللجنة التنفيذية</h3>
                    <p class="text-xs text-slate-400">بانتظار قرار المجلس</p>
                </div>

            </div>

            <!-- 2. منطقة العمليات (Audit Committee Workspace) -->
            <div id="auditWorkspace" class="grid grid-cols-1 lg:grid-cols-3 gap-6 transition-all duration-500">
                
                <!-- اليسار: إدارة الاجتماعات -->
                <div class="lg:col-span-2 bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-slate-800 dark:text-white flex items-center gap-2">
                            <i class="fa-solid fa-briefcase text-brandBlue"></i> أعمال لجنة المراجعة
                        </h3>
                        <div class="flex gap-2">
                            <button onclick="startCommWizard()" class="px-4 py-2 bg-brandBlue text-white rounded-xl text-xs font-bold hover:bg-blue-700 shadow-md flex items-center gap-2 transition">
                                <i class="fa-solid fa-plus"></i> اجتماع جديد
                            </button>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="border-b border-slate-200 dark:border-slate-700 mb-4">
                        <nav class="flex gap-6">
                            <button class="pb-3 text-sm font-bold text-brandBlue border-b-2 border-brandBlue">الاجتماعات الحالية</button>
                            <button class="pb-3 text-sm font-bold text-slate-500 hover:text-slate-700 border-b-2 border-transparent">الأرشيف</button>
                        </nav>
                    </div>

                    <!-- Empty State (No current meetings) -->
                    <div id="meetingsList" class="space-y-3">
                        <div class="text-center py-12 bg-slate-50 dark:bg-slate-700/30 rounded-xl border border-dashed border-slate-300 dark:border-slate-600">
                            <div class="w-14 h-14 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-3 text-slate-400 text-xl">
                                <i class="fa-solid fa-calendar-check"></i>
                            </div>
                            <p class="text-sm text-slate-500 font-bold">لا يوجد اجتماعات مجدولة حالياً</p>
                            <p class="text-xs text-slate-400 mt-1">ابدأ بإنشاء اجتماع لمناقشة القوائم المالية أو التقارير.</p>
                        </div>
                    </div>
                </div>

                <!-- اليمين: معلومات مالية وأمين السر -->
                <div class="lg:col-span-1 space-y-6">
                    
                    <!-- Remuneration Info -->
                    <div class="bg-white dark:bg-slate-800 p-5 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700">
                        <h3 class="font-bold text-sm mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-money-bill-wave text-green-500"></i> المستحقات المالية
                        </h3>
                        <div class="space-y-2 text-xs">
                            <div class="flex justify-between p-2 bg-slate-50 rounded border border-slate-100">
                                <span>عضو اللجنة</span>
                                <span class="font-bold font-en text-green-600">1,500 SAR</span>
                            </div>
                            <div class="flex justify-between p-2 bg-yellow-50 rounded border border-yellow-100">
                                <span class="font-bold text-yellow-800">أمين السر</span>
                                <span class="font-bold font-en text-green-600">1,000 SAR</span>
                            </div>
                        </div>
                        <div class="mt-3 text-[10px] text-slate-400">
                            * يتم احتساب المكافأة تلقائياً عند اعتماد محضر الاجتماع.
                        </div>
                    </div>

                    <!-- Secretary Profile -->
                    <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl p-5 text-white shadow-lg">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-lg border-2 border-brandRed"><i class="fa-solid fa-feather"></i></div>
                            <div>
                                <p class="text-xs text-slate-400">أمين سر اللجنة</p>
                                <p class="font-bold text-base">أيمن المغربي</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-center text-[10px]">
                            <div class="bg-white/5 p-2 rounded">
                                <span class="block text-slate-400">اجتماعات</span>
                                <span class="font-bold font-en text-lg">0</span>
                            </div>
                            <div class="bg-white/5 p-2 rounded">
                                <span class="block text-slate-400">مستحقات</span>
                                <span class="font-bold font-en text-lg text-green-400">0</span>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </main>
    </div>

    <!-- COMMITTEE MEETING WIZARD -->
    <div id="commWizardModal" class="hidden fixed inset-0 bg-black/60 z-50 flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-800 w-full max-w-4xl rounded-2xl shadow-2xl flex flex-col max-h-[90vh]">
            
            <!-- Header -->
            <div class="p-5 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900 rounded-t-2xl">
                <div>
                    <h3 class="font-bold text-lg flex items-center gap-2 text-slate-800 dark:text-white">
                        <i class="fa-solid fa-plus-circle text-brandBlue"></i> اجتماع لجنة جديد
                    </h3>
                    <p class="text-xs text-slate-500 mt-1" id="comm-wizard-subtitle">الخطوة 1: الإعداد والملفات</p>
                </div>
                <div class="flex items-center gap-4">
                    <!-- Progress Pills -->
                    <div class="flex gap-1 text-[10px] font-bold">
                        <span id="cw-step1" class="px-3 py-1 rounded-full bg-brandBlue text-white">الإعداد</span>
                        <span id="cw-step2" class="px-3 py-1 rounded-full bg-slate-100 text-slate-400">الحضور</span>
                        <span id="cw-step3" class="px-3 py-1 rounded-full bg-slate-100 text-slate-400">المحضر</span>
                        <span id="cw-step4" class="px-3 py-1 rounded-full bg-slate-100 text-slate-400">الاعتماد</span>
                    </div>
                    <button onclick="closeCommWizard()" class="text-slate-400 hover:text-red-500"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>
            </div>

            <!-- Body -->
            <div class="flex-1 p-6 overflow-y-auto">
                
                <!-- STEP 1: Setup & Files -->
                <div id="comm-step1" class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1">رقم الاجتماع</label>
                            <input type="text" class="w-full border rounded p-2 text-sm bg-slate-50" value="AUD-01-2026" readonly>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1">التاريخ</label>
                            <input type="date" class="w-full border rounded p-2 text-sm">
                        </div>
                        <div class="col-span-2">
                            <label class="block text-xs font-bold text-slate-500 mb-1">عنوان الاجتماع</label>
                            <input type="text" class="w-full border rounded p-2 text-sm" placeholder="مثال: مراجعة القوائم المالية الربع سنوية">
                        </div>
                    </div>

                    <!-- Agenda & Files Builder -->
                    <div class="border border-slate-200 rounded-xl p-4">
                        <h4 class="font-bold text-sm mb-3 flex justify-between items-center">
                            <span>بنود المناقشة والملفات المرفقة</span>
                            <button onclick="addCommAgenda()" class="text-xs bg-green-50 text-green-600 px-3 py-1.5 rounded border border-green-200 font-bold hover:bg-green-100">
                                <i class="fa-solid fa-plus"></i> إضافة بند
                            </button>
                        </h4>
                        <div id="commAgendaList" class="space-y-3">
                            <!-- Dynamic Items -->
                        </div>
                    </div>
                </div>

                <!-- STEP 2: Attendance -->
                <div id="comm-step2" class="hidden space-y-4">
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-100 flex justify-between items-center">
                        <span class="text-xs font-bold text-blue-800">حضور الأعضاء وأمين السر</span>
                        <span class="text-[10px] text-blue-600">يتم احتساب البدلات (1500 / 1000) للحاضرين فقط.</span>
                    </div>
                    <table class="w-full text-sm text-right border rounded-lg overflow-hidden">
                        <thead class="bg-slate-100">
                            <tr><th class="p-2">الاسم</th><th class="p-2">المنصب</th><th class="p-2">البدل</th><th class="p-2 text-center">حاضر</th></tr>
                        </thead>
                        <tbody class="divide-y">
                            <tr><td>محمد بن منصور العنزي</td><td class="text-xs text-slate-500">رئيس اللجنة</td><td class="text-xs font-mono text-green-600">1,500</td><td class="text-center"><input type="checkbox" checked class="accent-brandBlue"></td></tr>
                            <tr><td>عادل بن عدنان سعسع</td><td class="text-xs text-slate-500">عضو</td><td class="text-xs font-mono text-green-600">1,500</td><td class="text-center"><input type="checkbox" checked class="accent-brandBlue"></td></tr>
                            <tr><td>أحمد بن سلطان السحيباني</td><td class="text-xs text-slate-500">عضو</td><td class="text-xs font-mono text-green-600">1,500</td><td class="text-center"><input type="checkbox" checked class="accent-brandBlue"></td></tr>
                            <tr class="bg-yellow-50/50 font-bold text-slate-700"><td>أيمن المغربي</td><td class="text-xs text-slate-500">أمين السر</td><td class="text-xs font-mono text-green-600">1,000</td><td class="text-center"><input type="checkbox" checked class="accent-slate-500" disabled></td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- STEP 3: Minutes Draft -->
                <div id="comm-step3" class="hidden space-y-4">
                    <label class="block text-xs font-bold text-slate-500">مسودة المحضر</label>
                    <textarea class="w-full border rounded-xl p-4 text-sm h-64 bg-slate-50 leading-relaxed" id="minutesText">
اجتمع أعضاء لجنة المراجعة في يوم (...)، برئاسة الأستاذ محمد بن منصور العنزي.

تم استعراض البنود التالية:
1. [سيتم إدراج البنود تلقائياً]
2. ...

التوصيات والقرارات:
- وافقت اللجنة على...
- توصي اللجنة مجلس الإدارة بـ...
                    </textarea>
                </div>

                <!-- STEP 4: Approval & Signature -->
                <div id="comm-step4" class="hidden text-center py-10">
                    <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center text-4xl mx-auto mb-4">
                        <i class="fa-solid fa-file-signature"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">جاهز للإرسال</h3>
                    <p class="text-sm text-slate-500 mb-6">سيتم إرسال المحضر للأعضاء عبر النظام للمراجعة والتوقيع الإلكتروني.</p>
                    
                    <div class="flex justify-center gap-4">
                        <div class="bg-slate-50 p-3 rounded border text-xs text-left">
                            <p class="font-bold">المرفقات:</p>
                            <ul class="list-disc list-inside text-slate-500" id="filesSummary">
                                <li>لا يوجد ملفات</li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Footer -->
            <div class="p-5 border-t border-slate-200 bg-slate-50 dark:bg-slate-900 rounded-b-2xl flex justify-between">
                <button onclick="cwPrev()" id="cw-prev" class="px-5 py-2 border rounded-xl text-xs font-bold bg-white text-slate-600 disabled:opacity-50" disabled>السابق</button>
                <button onclick="cwNext()" id="cw-next" class="px-8 py-2 bg-brandBlue text-white rounded-xl text-xs font-bold hover:bg-blue-700">التالي</button>
            </div>
        </div>
    </div>

    <script src="layout.js"></script>

    <script>
        let cwStep = 1;
        let agendaFiles = [];

        function selectCommittee(type) {
            if(type === 'audit') {
                // Focus is already on audit workspace
            } else {
                alert('هذه اللجنة غير مفعلة حالياً.');
            }
        }

        // --- Wizard Logic ---
        function startCommWizard() {
            document.getElementById('commWizardModal').classList.remove('hidden');
            cwStep = 1;
            updateCwUI();
            // Add default agenda item
            const list = document.getElementById('commAgendaList');
            if(list.children.length === 0) addCommAgenda(); 
        }

        function closeCommWizard() {
            if(confirm('إغلاق المعالج؟ قد تفقد البيانات غير المحفوظة.')) {
                document.getElementById('commWizardModal').classList.add('hidden');
            }
        }

        function cwNext() {
            if(cwStep < 4) {
                cwStep++;
                updateCwUI();
            } else {
                alert("تم إرسال المحضر للتوقيع بنجاح!");
                document.getElementById('commWizardModal').classList.add('hidden');
            }
        }

        function cwPrev() {
            if(cwStep > 1) {
                cwStep--;
                updateCwUI();
            }
        }

        function updateCwUI() {
            // Toggle Steps
            for(let i=1; i<=4; i++) document.getElementById(`comm-step${i}`).classList.add('hidden');
            document.getElementById(`comm-step${cwStep}`).classList.remove('hidden');

            // Update Header
            const titles = ["", "الإعداد والملفات", "الحضور", "صياغة المحضر", "الاعتماد"];
            document.getElementById('comm-wizard-subtitle').innerText = `الخطوة ${cwStep}: ${titles[cwStep]}`;

            // Update Pills
            for(let i=1; i<=4; i++) {
                const pill = document.getElementById(`cw-step${i}`);
                pill.className = i === cwStep ? "px-3 py-1 rounded-full bg-brandBlue text-white" : (i < cwStep ? "px-3 py-1 rounded-full bg-green-100 text-green-600" : "px-3 py-1 rounded-full bg-slate-100 text-slate-400");
            }

            // Buttons
            document.getElementById('cw-prev').disabled = cwStep === 1;
            document.getElementById('cw-next').innerText = cwStep === 4 ? "إرسال للتوقيع" : "التالي";
        }

        // --- Agenda & Files Logic ---
        function addCommAgenda() {
            const list = document.getElementById('commAgendaList');
            const id = Date.now();
            
            const div = document.createElement('div');
            div.className = "p-3 border border-slate-200 rounded-xl bg-slate-50 space-y-2";
            div.innerHTML = `
                <input type="text" class="w-full bg-transparent font-bold text-sm outline-none border-b border-dashed border-slate-300 pb-1" placeholder="اكتب عنوان البند هنا...">
                <div class="flex items-center gap-2">
                    <label for="file-${id}" class="cursor-pointer text-[10px] bg-white border px-2 py-1 rounded hover:bg-slate-100 flex items-center gap-1 text-slate-600">
                        <i class="fa-solid fa-paperclip"></i> إرفاق ملف (PDF)
                    </label>
                    <input type="file" id="file-${id}" class="hidden" onchange="fileUploaded(this)">
                    <span class="text-[10px] text-slate-400" id="filename-${id}">لم يتم اختيار ملف</span>
                </div>
            `;
            list.appendChild(div);
        }

        function fileUploaded(input) {
            if(input.files && input.files[0]) {
                const span = document.getElementById(`filename-${input.id.split('-')[1]}`);
                span.innerText = input.files[0].name;
                span.classList.add('text-green-600', 'font-bold');
                span.classList.remove('text-slate-400');
                
                // Add to summary
                const summary = document.getElementById('filesSummary');
                if(summary.innerText.includes('لا يوجد')) summary.innerHTML = '';
                summary.innerHTML += `<li>${input.files[0].name}</li>`;
            }
        }

        // --- Tabs ---
        function switchTab(target) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('text-brandBlue', 'border-brandBlue');
                el.classList.add('text-slate-500', 'border-transparent');
            });
            document.getElementById(`tab-${target}`).classList.remove('hidden');
        }
    </script>
</body>
</html>
