<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">AndroGov | Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„Ø¹Ù‚ÙˆØ¯</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brandRed: '#FB4747',
                        brandBlue: '#4267B2',
                        brandDark: '#1E293B',
                        brandGray: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Tajawal', 'Inter', 'sans-serif'],
                        en: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
        }
        /* Custom Status Badges */
        .status-badge { @apply px-2 py-1 rounded text-[10px] font-bold border; }
        .status-pending { @apply bg-orange-50 text-orange-600 border-orange-200; }
        .status-approved { @apply bg-green-50 text-green-600 border-green-200; }
        .status-rejected { @apply bg-red-50 text-red-600 border-red-200; }
        
        body { transition: opacity 0.2s ease-in-out; }

        /* Bot Styles */
        .chat-window-anim { transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); transform-origin: bottom left; }
        .chat-bubble { max-width: 85%; padding: 10px 14px; border-radius: 12px; font-size: 0.9rem; line-height: 1.5; word-wrap: break-word; }
        .chat-bubble.bot { background-color: #f1f5f9; color: #334155; border-bottom-right-radius: 2px; }
        .dark .chat-bubble.bot { background-color: #334155; color: #f8fafc; }
        .chat-bubble.user { background-color: #4267B2; color: white; border-bottom-left-radius: 2px; margin-right: auto; }
        .typing-indicator span { display: inline-block; width: 6px; height: 6px; background-color: #94a3b8; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; margin: 0 1px; }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>
<body class="bg-brandGray dark:bg-slate-900 text-slate-800 dark:text-slate-100 font-sans transition-colors duration-300">

    <div id="sidebar-container" class="no-print"></div>
    
    <div class="main-content-wrapper md:mr-72 transition-all duration-300 flex flex-col min-h-screen">
        <div id="header-container" class="no-print"></div>

        <main class="p-6 space-y-6">
            
            <!-- 1. Procurement Dashboard -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 no-print">
                <!-- Total Requests -->
                <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs text-slate-500 dark:text-slate-400 font-bold uppercase" data-i18n="kpiReq">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ (PR)</p>
                            <h3 class="text-2xl font-bold mt-1 font-en text-blue-600">12</h3>
                        </div>
                        <div class="w-10 h-10 bg-blue-50 dark:bg-blue-900/30 text-blue-600 rounded-xl flex items-center justify-center text-xl"><i class="fa-solid fa-cart-shopping"></i></div>
                    </div>
                    <p class="text-[10px] text-slate-400 mt-2" data-i18n="kpiReqSub">3 Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</p>
                </div>

                <!-- Active Contracts -->
                <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs text-slate-500 dark:text-slate-400 font-bold uppercase" data-i18n="kpiCont">Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù†Ø´Ø·Ø©</p>
                            <h3 class="text-2xl font-bold mt-1 font-en text-purple-600">8</h3>
                        </div>
                        <div class="w-10 h-10 bg-purple-50 dark:bg-purple-900/30 text-purple-600 rounded-xl flex items-center justify-center text-xl"><i class="fa-solid fa-file-contract"></i></div>
                    </div>
                    <p class="text-[10px] text-slate-400 mt-2" data-i18n="kpiContSub">1 ÙŠÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
                </div>

                <!-- Budget Usage -->
                <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs text-slate-500 dark:text-slate-400 font-bold uppercase" data-i18n="kpiBud">Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</p>
                            <h3 class="text-2xl font-bold mt-1 font-en text-orange-500">45%</h3>
                        </div>
                        <div class="w-10 h-10 bg-orange-50 dark:bg-orange-900/30 text-orange-500 rounded-xl flex items-center justify-center text-xl"><i class="fa-solid fa-chart-pie"></i></div>
                    </div>
                    <div class="w-full bg-slate-100 h-1.5 rounded-full mt-3 overflow-hidden">
                        <div class="bg-orange-500 h-full w-[45%]"></div>
                    </div>
                </div>

                <!-- Pending POs -->
                <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs text-slate-500 dark:text-slate-400 font-bold uppercase" data-i18n="kpiPO">Ø£ÙˆØ§Ù…Ø± Ø´Ø±Ø§Ø¡ Ù…ÙØªÙˆØ­Ø©</p>
                            <h3 class="text-2xl font-bold mt-1 font-en text-green-600">5</h3>
                        </div>
                        <div class="w-10 h-10 bg-green-50 dark:bg-green-900/30 text-green-600 rounded-xl flex items-center justify-center text-xl"><i class="fa-solid fa-truck-fast"></i></div>
                    </div>
                    <p class="text-[10px] text-slate-400 mt-2" data-i18n="kpiPOSub">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 150,000 SAR</p>
                </div>
            </div>

            <!-- 2. Procurement Workspace -->
            <div class="bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 min-h-[600px] flex flex-col">
                
                <!-- Toolbar -->
                <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex bg-slate-100 dark:bg-slate-700 p-1 rounded-xl w-full md:w-auto overflow-x-auto">
                        <button onclick="switchTab('requests')" id="btn-requests" class="px-5 py-2 text-xs font-bold rounded-lg bg-white text-brandBlue shadow-sm transition-all tab-btn" data-i18n="tabPR">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ (PR)</button>
                        <button onclick="switchTab('orders')" id="btn-orders" class="px-5 py-2 text-xs font-bold rounded-lg text-slate-500 hover:text-slate-700 transition-all tab-btn" data-i18n="tabPO">Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (PO)</button>
                        <button onclick="switchTab('contracts')" id="btn-contracts" class="px-5 py-2 text-xs font-bold rounded-lg text-slate-500 hover:text-slate-700 transition-all tab-btn" data-i18n="tabCont">Ø§Ù„Ø¹Ù‚ÙˆØ¯ ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</button>
                        <button onclick="switchTab('assets')" id="btn-assets" class="px-5 py-2 text-xs font-bold rounded-lg text-slate-500 hover:text-slate-700 transition-all tab-btn" data-i18n="tabAssets">Ø§Ù„Ø£ØµÙˆÙ„ ÙˆØ§Ù„Ø¹Ù‡Ø¯</button>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="openPRModal()" class="px-4 py-2 bg-brandBlue text-white rounded-xl text-xs font-bold hover:bg-blue-700 transition flex items-center gap-2 shadow-lg">
                            <i class="fa-solid fa-plus"></i> <span data-i18n="btnAddPR">Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</span>
                        </button>
                    </div>
                </div>

                <!-- Tab 1: Purchase Requests (PR) -->
                <div id="tab-requests" class="tab-content block p-6">
                    <div class="flex justify-between mb-4">
                        <div class="relative w-64">
                            <input type="text" id="prSearch" onkeyup="filterPRs()" placeholder="..." class="w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 dark:border-slate-600 dark:bg-slate-700 rounded-xl text-sm focus:ring-2 focus:ring-brandBlue outline-none dark:text-white" data-i18n-placeholder="plhSearch">
                            <i class="fa-solid fa-search absolute left-3 top-2.5 text-slate-400 rtl:left-3 ltr:right-3"></i>
                        </div>
                        <select class="bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg px-3 py-1.5 text-xs focus:outline-none dark:text-white">
                            <option data-i18n="filterAll">Ø§Ù„ÙƒÙ„</option>
                            <option data-i18n="filterPending">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</option>
                            <option data-i18n="filterApproved">Ù…Ø¹ØªÙ…Ø¯</option>
                        </select>
                    </div>
                    
                    <div class="overflow-x-auto border border-slate-200 dark:border-slate-600 rounded-xl">
                        <table class="w-full text-sm text-right rtl:text-right ltr:text-left">
                            <thead class="bg-slate-50 dark:bg-slate-700 text-xs font-bold text-slate-500 uppercase">
                                <tr>
                                    <th class="p-4" data-i18n="colID">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                    <th class="p-4" data-i18n="colDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
                                    <th class="p-4" data-i18n="colDept">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                    <th class="p-4 w-1/3" data-i18n="colDesc">Ø§Ù„ÙˆØµÙ</th>
                                    <th class="p-4" data-i18n="colCost">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©</th>
                                    <th class="p-4 text-center" data-i18n="colStatus">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th class="p-4 text-center" data-i18n="colAction">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100 dark:divide-slate-700" id="prTable">
                                <!-- Generated Rows -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab 2: Purchase Orders (PO) -->
                <div id="tab-orders" class="tab-content hidden p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- PO List -->
                        <div class="border dark:border-slate-700 rounded-2xl p-4">
                            <h4 class="font-bold text-sm mb-4 dark:text-white" data-i18n="poActive">Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·Ø©</h4>
                            <div class="space-y-3" id="poList">
                                <!-- Populated via JS -->
                            </div>
                        </div>

                        <!-- Vendor Evaluation Preview -->
                        <div class="border dark:border-slate-700 rounded-2xl p-4 bg-slate-50 dark:bg-slate-700/50">
                            <h4 class="font-bold text-sm mb-4 dark:text-white" data-i18n="vendorPerf">Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (Top 3)</h4>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between text-xs mb-1 dark:text-slate-300">
                                        <span data-i18n="ven1Name">Ø´Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</span>
                                        <span class="text-green-600 font-bold">95%</span>
                                    </div>
                                    <div class="w-full bg-slate-200 dark:bg-slate-600 rounded-full h-1.5"><div class="bg-green-500 h-1.5 rounded-full" style="width: 95%"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-xs mb-1 dark:text-slate-300">
                                        <span data-i18n="ven2Name">Ù…Ø¤Ø³Ø³Ø© Ø§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</span>
                                        <span class="text-yellow-600 font-bold">80%</span>
                                    </div>
                                    <div class="w-full bg-slate-200 dark:bg-slate-600 rounded-full h-1.5"><div class="bg-yellow-500 h-1.5 rounded-full" style="width: 80%"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab 3: Contracts & Vendors -->
                <div id="tab-contracts" class="tab-content hidden p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2">
                             <div class="overflow-x-auto border border-slate-200 dark:border-slate-600 rounded-xl">
                                <table class="w-full text-sm text-right rtl:text-right ltr:text-left">
                                    <thead class="bg-slate-50 dark:bg-slate-700 text-xs font-bold text-slate-500">
                                        <tr>
                                            <th class="p-3" data-i18n="colContID">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯</th>
                                            <th class="p-3" data-i18n="colVendor">Ø§Ù„Ù…ÙˆØ±Ø¯</th>
                                            <th class="p-3" data-i18n="colEnd">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                                            <th class="p-3" data-i18n="colVal">Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                                            <th class="p-3 text-center" data-i18n="colAlert">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-100 dark:divide-slate-700" id="contractsTable">
                                        <!-- JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="lg:col-span-1 bg-slate-50 dark:bg-slate-700/30 p-4 rounded-xl">
                            <h4 class="font-bold text-sm mb-3 dark:text-white" data-i18n="addVendor">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯</h4>
                            <form class="space-y-3">
                                <input type="text" class="w-full border dark:border-slate-600 rounded p-2 text-xs dark:bg-slate-700 dark:text-white" data-i18n-placeholder="plhCompName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©">
                                <input type="text" class="w-full border dark:border-slate-600 rounded p-2 text-xs dark:bg-slate-700 dark:text-white" data-i18n-placeholder="plhCR" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ">
                                <input type="email" class="w-full border dark:border-slate-600 rounded p-2 text-xs dark:bg-slate-700 dark:text-white" data-i18n-placeholder="plhEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                                <button type="button" onclick="alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯')" class="w-full bg-slate-800 text-white py-2 rounded text-xs font-bold hover:bg-black" data-i18n="btnSaveVendor">Ø­ÙØ¸</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Tab 4: Assets (Ø§Ù„Ø£ØµÙˆÙ„) -->
                <div id="tab-assets" class="tab-content hidden p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-bold text-sm dark:text-white" data-i18n="assetsLog">Ø³Ø¬Ù„ Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ø«Ø§Ø¨ØªØ© ÙˆØ§Ù„Ø¹Ù‡Ø¯</h4>
                        <button class="text-xs bg-white dark:bg-slate-700 border dark:border-slate-600 px-3 py-1 rounded hover:bg-slate-50 dark:hover:bg-slate-600 dark:text-white" data-i18n="btnAddAsset">+ Ø¥Ø¶Ø§ÙØ© Ø£ØµÙ„</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Asset Card -->
                        <div class="p-4 border dark:border-slate-700 rounded-xl hover:border-brandBlue transition group cursor-pointer bg-white dark:bg-slate-700/30">
                            <div class="flex justify-between items-start mb-2">
                                <div class="p-2 bg-blue-50 dark:bg-blue-900/30 text-blue-600 rounded-lg"><i class="fa-solid fa-laptop"></i></div>
                                <span class="text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded" data-i18n="astCustody">Ø¹Ù‡Ø¯Ø©</span>
                            </div>
                            <h5 class="font-bold text-sm dark:text-white" data-i18n="ast1Name">MacBook Pro M3</h5>
                            <p class="text-xs text-slate-500 mt-1">S/N: XYZ123</p>
                            <p class="text-[10px] text-slate-400 mt-2"><span data-i18n="astEmp">Ø§Ù„Ù…ÙˆØ¸Ù:</span> <span data-i18n="empName">Ù‡Ø´Ø§Ù… Ø§Ù„Ø³Ø­ÙŠØ¨Ø§Ù†ÙŠ</span></p>
                        </div>
                        <!-- Asset Card -->
                        <div class="p-4 border dark:border-slate-700 rounded-xl hover:border-brandBlue transition group cursor-pointer bg-white dark:bg-slate-700/30">
                            <div class="flex justify-between items-start mb-2">
                                <div class="p-2 bg-blue-50 dark:bg-blue-900/30 text-blue-600 rounded-lg"><i class="fa-solid fa-chair"></i></div>
                                <span class="text-[10px] bg-slate-100 dark:bg-slate-600 text-slate-700 dark:text-slate-300 px-2 py-0.5 rounded" data-i18n="astStock">Ù…Ø®Ø²ÙˆÙ†</span>
                            </div>
                            <h5 class="font-bold text-sm dark:text-white" data-i18n="ast2Name">ÙƒØ±Ø§Ø³ÙŠ Ù…ÙƒØªØ¨ÙŠØ© (10)</h5>
                            <p class="text-xs text-slate-500 mt-1" data-i18n="astLoc">Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</p>
                            <p class="text-[10px] text-slate-400 mt-2">2025-10-01</p>
                        </div>
                    </div>
                </div>

            </div>

        </main>
    </div>

    <!-- New Purchase Request Modal -->
    <div id="prModal" class="fixed inset-0 bg-black/60 hidden z-50 flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-800 w-full max-w-2xl rounded-2xl shadow-xl p-6">
            <div class="flex justify-between items-center mb-4 border-b pb-2 dark:border-slate-700">
                <h3 class="font-bold text-lg dark:text-white" data-i18n="modPrTitle">Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ (PR)</h3>
                <button onclick="document.getElementById('prModal').classList.add('hidden')"><i class="fa-solid fa-xmark text-slate-400"></i></button>
            </div>
            
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="modDept">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                        <select class="w-full border dark:border-slate-600 rounded p-2 text-sm bg-slate-50 dark:bg-slate-700 dark:text-white">
                            <option data-i18n="dIT">ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                            <option data-i18n="dHR">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</option>
                            <option data-i18n="dAdmin">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="modDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬</label>
                        <input type="date" class="w-full border dark:border-slate-600 rounded p-2 text-sm bg-slate-50 dark:bg-slate-700 dark:text-white">
                    </div>
                </div>
                
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="modTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø·Ù„Ø¨</label>
                    <input type="text" class="w-full border dark:border-slate-600 rounded p-2 text-sm dark:bg-slate-700 dark:text-white" data-i18n-placeholder="plhPrTitle" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø¬Ù‡Ø²Ø© Ù„Ø§Ø¨ØªÙˆØ¨ Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯">
                </div>

                <div class="border dark:border-slate-600 rounded-xl overflow-hidden">
                    <table class="w-full text-xs text-right rtl:text-right ltr:text-left">
                        <thead class="bg-slate-100 dark:bg-slate-700">
                            <tr>
                                <th class="p-2 w-1/2" data-i18n="colItem">Ø§Ù„Ø¨Ù†Ø¯</th>
                                <th class="p-2" data-i18n="colQty">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th class="p-2" data-i18n="colPrice">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠ</th>
                                <th class="p-2 text-center">x</th>
                            </tr>
                        </thead>
                        <tbody class="dark:text-white">
                            <tr>
                                <td class="p-2"><input type="text" class="w-full border dark:border-slate-600 rounded p-1 dark:bg-slate-700" placeholder="..."></td>
                                <td class="p-2"><input type="number" class="w-full border dark:border-slate-600 rounded p-1 text-center dark:bg-slate-700" placeholder="0"></td>
                                <td class="p-2"><input type="number" class="w-full border dark:border-slate-600 rounded p-1 text-center dark:bg-slate-700" placeholder="0.00"></td>
                                <td class="p-2 text-center text-red-500 cursor-pointer"><i class="fa-solid fa-trash"></i></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="p-2 bg-slate-50 dark:bg-slate-700 text-center">
                        <button class="text-xs text-brandBlue font-bold" data-i18n="btnAddLine">+ Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±</button>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="modJust">Ù…Ø¨Ø±Ø±Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡</label>
                    <textarea class="w-full border dark:border-slate-600 rounded p-2 text-sm h-16 dark:bg-slate-700 dark:text-white" placeholder="..."></textarea>
                </div>
            </div>

            <div class="mt-6 flex justify-end gap-3">
                <button onclick="document.getElementById('prModal').classList.add('hidden')" class="px-4 py-2 border dark:border-slate-600 rounded-lg text-xs font-bold hover:bg-slate-50 dark:hover:bg-slate-700 dark:text-white" data-i18n="cancel">Ø¥Ù„ØºØ§Ø¡</button>
                <button onclick="alert('ØªÙ… Ø±ÙØ¹ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©'); document.getElementById('prModal').classList.add('hidden')" class="px-6 py-2 bg-brandBlue text-white rounded-lg text-xs font-bold hover:bg-blue-700" data-i18n="btnSubmit">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©</button>
            </div>
        </div>
    </div>

    <!-- AndroBot Widget (AI Assistant) -->
    <div id="andro-bot-container" class="fixed bottom-6 left-6 z-50 flex flex-col items-start gap-4 font-sans" dir="rtl">
        <!-- Chat Window -->
        <div id="chat-window" class="hidden bg-white dark:bg-slate-800 w-80 md:w-96 rounded-2xl shadow-2xl border border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col chat-window-anim" style="height: 500px; max-height: 70vh;">
            <div class="bg-brandBlue p-4 flex justify-between items-center text-white">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center"><i class="fa-solid fa-robot"></i></div>
                    <div><h4 class="font-bold text-sm">AndroBot</h4><p class="text-[10px] text-white/80">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø°ÙƒÙŠ</p></div>
                </div>
                <button id="close-chat-btn" class="text-white/80 hover:text-white transition"><i class="fa-solid fa-times"></i></button>
            </div>
            <div id="chat-body" class="flex-1 p-4 bg-slate-50 dark:bg-slate-900/50 overflow-y-auto custom-scroll space-y-3 flex flex-col">
                <div class="chat-bubble bot">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ğŸ‘‹<br>Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø£Ùˆ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ø¹Ù‚ÙˆØ¯.</div>
                <div class="flex flex-wrap gap-2 mt-2" id="suggestions">
                    <button class="suggestion-btn text-xs bg-white border border-brandBlue/30 text-brandBlue px-3 py-1.5 rounded-full" data-q="Ø¹Ø¯Ø¯ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡">Ø¹Ø¯Ø¯ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡</button>
                    <button class="suggestion-btn text-xs bg-white border border-brandBlue/30 text-brandBlue px-3 py-1.5 rounded-full" data-q="Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù†Ø´Ø·Ø©">Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù†Ø´Ø·Ø©</button>
                </div>
            </div>
            <div class="p-3 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 flex gap-2">
                <input type="text" id="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ..." class="flex-1 bg-slate-100 dark:bg-slate-900 border-none rounded-lg text-sm px-4 py-2 focus:ring-2 focus:ring-brandBlue outline-none dark:text-white">
                <button id="send-btn" class="w-10 h-10 rounded-lg bg-brandBlue text-white hover:bg-blue-700 transition flex items-center justify-center"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>
        <!-- Floating Button -->
        <button id="chat-fab" class="w-14 h-14 bg-brandBlue hover:bg-blue-700 text-white rounded-full shadow-lg shadow-blue-600/30 flex items-center justify-center text-2xl transition-all transform hover:scale-110 active:scale-95 animate-bounce-slow">
            <i class="fa-solid fa-comment-dots"></i>
            <span class="absolute top-0 right-0 w-4 h-4 bg-brandRed rounded-full border-2 border-white dark:border-slate-900"></span>
        </button>
    </div>

    <script src="layout.js"></script>
    <script src="bot.js"></script>

    <script>
        // --- Translation Dictionary ---
        const t = {
            ar: {
                pageTitle: "AndroGov | Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„Ø¹Ù‚ÙˆØ¯",
                kpiReq: "Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ (PR)",
                kpiReqSub: "3 Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯",
                kpiCont: "Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù†Ø´Ø·Ø©",
                kpiContSub: "1 ÙŠÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹",
                kpiBud: "Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©",
                kpiPO: "Ø£ÙˆØ§Ù…Ø± Ø´Ø±Ø§Ø¡ Ù…ÙØªÙˆØ­Ø©",
                kpiPOSub: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 150,000 SAR",
                tabPR: "Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ (PR)",
                tabPO: "Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (PO)",
                tabCont: "Ø§Ù„Ø¹Ù‚ÙˆØ¯ ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†",
                tabAssets: "Ø§Ù„Ø£ØµÙˆÙ„ ÙˆØ§Ù„Ø¹Ù‡Ø¯",
                btnAddPR: "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯",
                plhSearch: "Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨...",
                filterAll: "Ø§Ù„ÙƒÙ„",
                filterPending: "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©",
                filterApproved: "Ù…Ø¹ØªÙ…Ø¯",
                colID: "Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨",
                colDate: "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨",
                colDept: "Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨",
                colDesc: "Ø§Ù„ÙˆØµÙ",
                colCost: "Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©",
                colStatus: "Ø§Ù„Ø­Ø§Ù„Ø©",
                colAction: "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª",
                statPending: "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©",
                statApproved: "Ù…Ø¹ØªÙ…Ø¯",
                statRejected: "Ù…Ø±ÙÙˆØ¶",
                poActive: "Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·Ø©",
                poRec: "ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…",
                poProc: "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¬Ù‡ÙŠØ²",
                vendorPerf: "Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (Top 3)",
                ven1Name: "Ø´Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©",
                ven2Name: "Ù…Ø¤Ø³Ø³Ø© Ø§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©",
                colContID: "Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯",
                colVendor: "Ø§Ù„Ù…ÙˆØ±Ø¯",
                colEnd: "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡",
                colVal: "Ø§Ù„Ù‚ÙŠÙ…Ø©",
                colAlert: "Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª",
                alertActive: "Ø³Ø§Ø±ÙŠ",
                alertSoon: "ÙŠÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹",
                addVendor: "Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯",
                plhCompName: "Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©",
                plhCR: "Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ",
                plhEmail: "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
                btnSaveVendor: "Ø­ÙØ¸",
                assetsLog: "Ø³Ø¬Ù„ Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ø«Ø§Ø¨ØªØ© ÙˆØ§Ù„Ø¹Ù‡Ø¯",
                btnAddAsset: "+ Ø¥Ø¶Ø§ÙØ© Ø£ØµÙ„",
                astCustody: "Ø¹Ù‡Ø¯Ø©",
                ast1Name: "MacBook Pro M3",
                astEmp: "Ø§Ù„Ù…ÙˆØ¸Ù:",
                empName: "Ù‡Ø´Ø§Ù… Ø§Ù„Ø³Ø­ÙŠØ¨Ø§Ù†ÙŠ",
                astStock: "Ù…Ø®Ø²ÙˆÙ†",
                ast2Name: "ÙƒØ±Ø§Ø³ÙŠ Ù…ÙƒØªØ¨ÙŠØ© (10)",
                astLoc: "Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",
                modPrTitle: "Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ (PR)",
                modDept: "Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨",
                dIT: "ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",
                dHR: "Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©",
                dAdmin: "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©",
                modDate: "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬",
                modTitle: "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø·Ù„Ø¨",
                plhPrTitle: "Ù…Ø«Ø§Ù„: Ø£Ø¬Ù‡Ø²Ø© Ù„Ø§Ø¨ØªÙˆØ¨ Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯",
                colItem: "Ø§Ù„Ø¨Ù†Ø¯",
                colQty: "Ø§Ù„ÙƒÙ…ÙŠØ©",
                colPrice: "Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠ",
                btnAddLine: "+ Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±",
                modJust: "Ù…Ø¨Ø±Ø±Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡",
                cancel: "Ø¥Ù„ØºØ§Ø¡",
                btnSubmit: "Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©",
                // Data
                pr1Desc: "Ø³ÙŠØ±ÙØ±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¯Ø§ØªØ§ Ø³Ù†ØªØ±",
                pr2Desc: "Ù‚Ø±Ø·Ø§Ø³ÙŠØ© ÙˆÙ…Ø³ØªÙ„Ø²Ù…Ø§Øª Ù…ÙƒØªØ¨ÙŠØ©",
                pr3Desc: "Ø®Ø¯Ù…Ø§Øª ØªØµÙ…ÙŠÙ… Ù‡ÙˆÙŠØ©",
                po1Desc: "ØªÙˆØ±ÙŠØ¯ Ø£Ø¬Ù‡Ø²Ø© (Ø¬Ø±ÙŠØ±)",
                po2Desc: "Ø±Ø®Øµ Ø¨Ø±Ø§Ù…Ø¬ (Microsoft)",
                cnt1Vend: "Ø´Ø±ÙƒØ© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©",
                cnt2Vend: "Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø­Ø§Ù…Ø§Ø©"
            },
            en: {
                pageTitle: "AndroGov | Procurement & Contracts",
                kpiReq: "Purchase Requests (PR)",
                kpiReqSub: "3 Pending Approval",
                kpiCont: "Active Contracts",
                kpiContSub: "1 Expiring Soon",
                kpiBud: "Budget Usage",
                kpiPO: "Open POs",
                kpiPOSub: "Total: 150,000 SAR",
                tabPR: "Purchase Requests (PR)",
                tabPO: "Purchase Orders (PO)",
                tabCont: "Contracts & Vendors",
                tabAssets: "Assets & Custody",
                btnAddPR: "New Request",
                plhSearch: "Search Request No...",
                filterAll: "All",
                filterPending: "Pending",
                filterApproved: "Approved",
                colID: "Req No",
                colDate: "Date",
                colDept: "Dept",
                colDesc: "Description",
                colCost: "Est. Cost",
                colStatus: "Status",
                colAction: "Actions",
                statPending: "Pending",
                statApproved: "Approved",
                statRejected: "Rejected",
                poActive: "Active Purchase Orders",
                poRec: "Received",
                poProc: "Processing",
                vendorPerf: "Top 3 Vendors",
                ven1Name: "Advanced Tech Co.",
                ven2Name: "Fast Supply Est.",
                colContID: "Contract No",
                colVendor: "Vendor",
                colEnd: "End Date",
                colVal: "Value",
                colAlert: "Alerts",
                alertActive: "Active",
                alertSoon: "Expiring Soon",
                addVendor: "Add New Vendor",
                plhCompName: "Company Name",
                plhCR: "CR Number",
                plhEmail: "Email",
                btnSaveVendor: "Save",
                assetsLog: "Fixed Assets & Custody Log",
                btnAddAsset: "+ Add Asset",
                astCustody: "Custody",
                ast1Name: "MacBook Pro M3",
                astEmp: "Employee:",
                empName: "Hesham Al-Suhaibani",
                astStock: "Stock",
                ast2Name: "Office Chairs (10)",
                astLoc: "Loc: Main Warehouse",
                modPrTitle: "New Purchase Request (PR)",
                modDept: "Department",
                dIT: "IT",
                dHR: "HR",
                dAdmin: "General Admin",
                modDate: "Needed Date",
                modTitle: "Request Title",
                plhPrTitle: "Ex: Laptops for new hires",
                colItem: "Item",
                colQty: "Qty",
                colPrice: "Est. Price",
                btnAddLine: "+ Add Line",
                modJust: "Justification",
                cancel: "Cancel",
                btnSubmit: "Submit",
                // Data
                pr1Desc: "New Data Center Servers",
                pr2Desc: "Office Stationery",
                pr3Desc: "Identity Design Services",
                po1Desc: "Hardware Supply (Jarir)",
                po2Desc: "Software Licenses (Microsoft)",
                cnt1Vend: "STC",
                cnt2Vend: "Law Firm"
            }
        };

        // Mock Data
        const prs = [
            { id: "PR-2026-010", date: "2026-01-08", dept: "IT", descAr: "Ø³ÙŠØ±ÙØ±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¯Ø§ØªØ§ Ø³Ù†ØªØ±", descEn: "New Data Center Servers", amount: 45000, status: "pending" },
            { id: "PR-2026-009", date: "2026-01-05", dept: "HR", descAr: "Ù‚Ø±Ø·Ø§Ø³ÙŠØ© ÙˆÙ…Ø³ØªÙ„Ø²Ù…Ø§Øª Ù…ÙƒØªØ¨ÙŠØ©", descEn: "Office Stationery", amount: 2500, status: "approved" },
            { id: "PR-2026-008", date: "2026-01-02", dept: "Marketing", descAr: "Ø®Ø¯Ù…Ø§Øª ØªØµÙ…ÙŠÙ… Ù‡ÙˆÙŠØ©", descEn: "Identity Design Services", amount: 15000, status: "rejected" }
        ];

        const contracts = [
            { id: "CNT-2025-05", vendorAr: "Ø´Ø±ÙƒØ© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©", vendorEn: "STC", end: "2026-05-01", val: "120,000 SAR", alert: "active" },
            { id: "CNT-2025-12", vendorAr: "Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø­Ø§Ù…Ø§Ø©", vendorEn: "Law Firm", end: "2026-02-15", val: "50,000 SAR", alert: "soon" }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            updatePageLanguage();
        });

        window.updatePageLanguage = function() {
            const lang = localStorage.getItem('lang') || 'ar';
            const dict = t[lang];
            
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            // Text
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(dict[key]) el.innerText = dict[key];
            });
            // Placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if(dict[key]) el.placeholder = dict[key];
            });

            renderPRs();
            renderContracts();
            renderPOs();
        }

        // --- Tab Switching ---
        window.switchTab = function(target) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('bg-white', 'text-brandBlue', 'shadow-sm');
                el.classList.add('text-slate-500');
            });
            document.getElementById(`tab-${target}`).classList.remove('hidden');
            document.getElementById(`btn-${target}`).classList.add('bg-white', 'text-brandBlue', 'shadow-sm');
            document.getElementById(`btn-${target}`).classList.remove('text-slate-500', 'border-transparent');
        }

        // --- Render Functions ---
        window.renderPRs = function() {
            const lang = localStorage.getItem('lang') || 'ar';
            const dict = t[lang];
            const tbody = document.getElementById('prTable');
            const search = document.getElementById('prSearch').value.toLowerCase();

            const filtered = prs.filter(e => e.id.toLowerCase().includes(search));

            tbody.innerHTML = filtered.map(e => {
                let statusBadge = '';
                if(e.status === 'pending') statusBadge = `<span class="status-badge status-pending">${dict.statPending}</span>`;
                if(e.status === 'approved') statusBadge = `<span class="status-badge status-approved">${dict.statApproved}</span>`;
                if(e.status === 'rejected') statusBadge = `<span class="status-badge status-rejected">${dict.statRejected}</span>`;

                const desc = lang === 'ar' ? e.descAr : e.descEn;

                return `
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-700/50 transition border-b border-slate-100 dark:border-slate-700">
                    <td class="p-4 font-mono text-xs font-bold text-brandBlue">${e.id}</td>
                    <td class="p-4 font-en text-xs text-slate-500">${e.date}</td>
                    <td class="p-4 text-xs font-bold text-slate-700 dark:text-white">${e.dept}</td>
                    <td class="p-4 text-xs text-slate-600 dark:text-slate-300 text-left rtl:text-right ltr:text-left">${desc}</td>
                    <td class="p-4 font-mono text-xs font-bold text-slate-600 dark:text-slate-200 text-left rtl:text-left ltr:text-right">${e.amount.toLocaleString()}</td>
                    <td class="p-4 text-center">${statusBadge}</td>
                    <td class="p-4 text-center">
                        <button class="text-slate-400 hover:text-brandBlue"><i class="fa-solid fa-eye"></i></button>
                    </td>
                </tr>
            `}).join('');
        }

        window.filterPRs = function() {
            renderPRs();
        }

        window.renderContracts = function() {
            const lang = localStorage.getItem('lang') || 'ar';
            const dict = t[lang];
            const tbody = document.getElementById('contractsTable');
            
            tbody.innerHTML = contracts.map(c => {
                const vendor = lang === 'ar' ? c.vendorAr : c.vendorEn;
                const alertText = c.alert === 'active' ? dict.alertActive : dict.alertSoon;
                const alertClass = c.alert === 'active' ? 'text-green-600' : 'text-red-500 font-bold';

                return `
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-700/50 transition border-b border-slate-100 dark:border-slate-700">
                    <td class="p-3 font-mono text-xs dark:text-slate-300">${c.id}</td>
                    <td class="p-3 font-bold text-xs dark:text-white">${vendor}</td>
                    <td class="p-3 font-en text-xs dark:text-slate-300">${c.end}</td>
                    <td class="p-3 font-en text-xs font-bold dark:text-slate-200">${c.val}</td>
                    <td class="p-3 text-center text-xs ${alertClass}">${alertText}</td>
                </tr>
            `}).join('');
        }

        window.renderPOs = function() {
            const lang = localStorage.getItem('lang') || 'ar';
            const dict = t[lang];
            const list = document.getElementById('poList');
            
            list.innerHTML = `
                <div class="flex justify-between items-center p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg border border-slate-200 dark:border-slate-600">
                    <div>
                        <p class="text-xs font-bold text-blue-800 dark:text-blue-300">PO-2026-001</p>
                        <p class="text-[10px] text-slate-500 dark:text-slate-400">${dict.po1Desc}</p>
                    </div>
                    <span class="text-[10px] bg-green-100 text-green-700 px-2 py-1 rounded">${dict.poRec}</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg border border-slate-200 dark:border-slate-600">
                    <div>
                        <p class="text-xs font-bold text-blue-800 dark:text-blue-300">PO-2026-002</p>
                        <p class="text-[10px] text-slate-500 dark:text-slate-400">${dict.po2Desc}</p>
                    </div>
                    <span class="text-[10px] bg-yellow-100 text-yellow-700 px-2 py-1 rounded">${dict.poProc}</span>
                </div>
            `;
        }

        // --- Modals ---
        window.openPRModal = function() {
            document.getElementById('prModal').classList.remove('hidden');
        }

        // --- Bot Override for Procurement Context ---
        const originalGetAIResponse = window.getAIResponse; 
        
        window.getAIResponse = function(query, isArabic) {
            const q = query.toLowerCase();
            
            if (q.includes('request') || q.includes('pr') || q.includes('Ø·Ù„Ø¨') || q.includes('Ø´Ø±Ø§Ø¡')) {
                return isArabic 
                    ? `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡: <b>12</b>. ÙŠÙˆØ¬Ø¯ <b>3</b> Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯.`
                    : `Total Purchase Requests: <b>12</b>. There are <b>3</b> pending approval.`;
            }
            
            if (q.includes('contract') || q.includes('active') || q.includes('Ø¹Ù‚Ø¯') || q.includes('Ø¹Ù‚ÙˆØ¯')) {
                return isArabic
                    ? `Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù†Ø´Ø·Ø©: <b>8</b>. ÙŠÙˆØ¬Ø¯ Ø¹Ù‚Ø¯ ÙˆØ§Ø­Ø¯ ÙŠÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹.`
                    : `Active Contracts: <b>8</b>. One contract is expiring soon.`;
            }

            if (q.includes('budget') || q.includes('usage') || q.includes('Ù…ÙŠØ²Ø§Ù†ÙŠØ©') || q.includes('Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ')) {
                return isArabic
                    ? `Ù†Ø³Ø¨Ø© Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù‡ÙŠ <b>45%</b>.`
                    : `Current budget usage is <b>45%</b>.`;
            }

            // Fallback default
            return isArabic
                ? `ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø¹Ù†: <b>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡</b>ØŒ <b>Ø§Ù„Ø¹Ù‚ÙˆØ¯</b>ØŒ Ø£Ùˆ <b>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</b>.`
                : `I can answer about: <b>Purchase Requests</b>, <b>Contracts</b>, or <b>Budget</b>.`;
        }

    </script>
</body>
</html>
