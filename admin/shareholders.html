<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#FB4747">
<link rel="manifest" href="manifest.json">

    <title data-i18n="pageTitle">AndroGov | Ø³Ø¬Ù„ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ†</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brandRed: '#FB4747',
                        brandBlue: '#4267B2',
                        brandDark: '#1E293B',
                        brandGray: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Tajawal', 'Inter', 'sans-serif'],
                        en: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .print-header { display: block !important; margin-bottom: 20px; text-align: center; }
        }
        .print-header { display: none; }
        
        body { transition: opacity 0.2s ease-in-out; }

        /* Bot Styles */
        .chat-window-anim { transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); transform-origin: bottom left; }
        .chat-bubble { max-width: 85%; padding: 10px 14px; border-radius: 12px; font-size: 0.9rem; line-height: 1.5; word-wrap: break-word; }
        .chat-bubble.bot { background-color: #f1f5f9; color: #334155; border-bottom-right-radius: 2px; }
        .dark .chat-bubble.bot { background-color: #334155; color: #f8fafc; }
        .chat-bubble.user { background-color: #4267B2; color: white; border-bottom-left-radius: 2px; margin-right: auto; }
        .typing-indicator span { display: inline-block; width: 6px; height: 6px; background-color: #94a3b8; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; margin: 0 1px; }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>
<body class="bg-brandGray dark:bg-slate-900 text-slate-800 dark:text-slate-100 font-sans transition-colors duration-300">

    <div id="sidebar-container" class="no-print"></div>
    
    <div class="main-content-wrapper md:mr-72 transition-all duration-300 flex flex-col min-h-screen">
        <div id="header-container" class="no-print"></div>

        <main class="p-6 space-y-6">
            
            <!-- Print Header -->
            <div class="print-header">
                <h1 class="text-2xl font-bold">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ† - Ø´Ø±ÙƒØ© Ø§Ù†Ø¯Ø±ÙˆÙ…ÙŠØ¯Ø§</h1>
                <p>Date: <span id="printDate"></span></p>
            </div>

            <!-- 1. KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 no-print">
                <!-- Current Capital -->
                <div class="bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 relative overflow-hidden">
                    <div class="absolute top-0 right-0 rtl:right-0 ltr:right-0 w-2 h-full bg-brandBlue"></div>
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs text-slate-500 dark:text-slate-400 font-bold uppercase" data-i18n="kpiCapital">Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                            <h3 class="text-2xl font-bold mt-1 font-en text-brandBlue">6,000,000 <span class="text-xs text-slate-400" data-i18n="curr">SAR</span></h3>
                        </div>
                        <div class="w-10 h-10 rounded-xl bg-blue-50 dark:bg-blue-900/30 text-brandBlue flex items-center justify-center text-xl">
                            <i class="fa-solid fa-coins"></i>
                        </div>
                    </div>
                    <div class="mt-4 text-xs text-green-600 font-bold bg-green-50 px-2 py-1 rounded w-fit">
                        <i class="fa-solid fa-check-circle"></i> <span data-i18n="paidFull">Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</span>
                    </div>
                </div>

                <!-- Shares Count -->
                <div class="bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs text-slate-500 dark:text-slate-400 font-bold uppercase" data-i18n="kpiShares">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ù…ØµØ¯Ø±Ø©</p>
                            <h3 class="text-2xl font-bold mt-1 font-en text-purple-600">600,000 <span class="text-xs text-slate-400" data-i18n="shareUnit">Ø³Ù‡Ù…</span></h3>
                        </div>
                        <div class="w-10 h-10 rounded-xl bg-purple-50 dark:bg-purple-900/30 text-purple-600 flex items-center justify-center text-xl">
                            <i class="fa-solid fa-layer-group"></i>
                        </div>
                    </div>
                    <div class="mt-4 text-xs text-slate-400">
                        <span data-i18n="parValue">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³Ù…ÙŠØ©</span>: <span class="font-bold font-en text-slate-600 dark:text-slate-300">10 SAR</span>
                    </div>
                </div>

                <!-- Shareholders Count -->
                <div class="bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs text-slate-500 dark:text-slate-400 font-bold uppercase" data-i18n="kpiCount">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ†</p>
                            <h3 class="text-2xl font-bold mt-1 font-en text-slate-700 dark:text-white">11</h3>
                        </div>
                        <div class="w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-700 text-slate-500 flex items-center justify-center text-xl">
                            <i class="fa-solid fa-users"></i>
                        </div>
                    </div>
                    <div class="mt-4 flex -space-x-2 space-x-reverse rtl:space-x-reverse ltr:space-x-reverse-0">
                        <span class="w-6 h-6 rounded-full bg-slate-200 border-2 border-white flex items-center justify-center text-[8px] font-bold">W</span>
                        <span class="w-6 h-6 rounded-full bg-slate-300 border-2 border-white flex items-center justify-center text-[8px] font-bold">H</span>
                        <span class="w-6 h-6 rounded-full bg-slate-400 border-2 border-white flex items-center justify-center text-[8px] font-bold text-white">+8</span>
                    </div>
                </div>
            </div>

            <!-- 2. Chart & History -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 no-print">
                
                <!-- Ownership Chart -->
                <div class="lg:col-span-1 bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <h3 class="font-bold text-sm mb-6 text-slate-700 dark:text-white flex items-center gap-2">
                        <i class="fa-solid fa-chart-pie text-brandBlue"></i> <span data-i18n="chartTitle">Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ù„ÙƒÙŠØ©</span>
                    </h3>
                    <div class="h-48 relative flex justify-center">
                        <canvas id="sharesChart"></canvas>
                    </div>
                    <div class="mt-6 space-y-2" id="chartLegend">
                        <!-- Injected by JS -->
                    </div>
                </div>

                <!-- Capital History -->
                <div class="lg:col-span-2 bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <h3 class="font-bold text-sm mb-6 text-slate-700 dark:text-white flex items-center gap-2">
                        <i class="fa-solid fa-clock-rotate-left text-slate-400"></i> <span data-i18n="histTitle">Ø³Ø¬Ù„ Ø§Ù„ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„</span>
                    </h3>
                    
                    <div class="relative pl-6 rtl:pl-0 rtl:pr-6 border-l rtl:border-l-0 rtl:border-r border-slate-200 dark:border-slate-700 space-y-8 ml-2 rtl:ml-0 rtl:mr-2">
                        <!-- Event 1 (Current) -->
                        <div class="relative">
                            <div class="absolute top-1.5 -left-[31px] rtl:left-auto rtl:-right-[31px] w-4 h-4 bg-green-500 rounded-full border-4 border-white dark:border-slate-800"></div>
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-bold text-sm text-slate-800 dark:text-white" data-i18n="evt1Title">ØªØ®ÙÙŠØ¶ Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ (Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ)</h4>
                                    <p class="text-xs text-slate-500 mt-1" data-i18n="evt1Desc">Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù‚Ø±Ø§Ø± Ø§Ù„Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© ØºÙŠØ± Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© (Ø¥Ø·ÙØ§Ø¡ Ø®Ø³Ø§Ø¦Ø±).</p>
                                </div>
                                <span class="bg-green-100 text-green-700 px-2 py-1 rounded text-[10px] font-bold font-en">6,000,000 SAR</span>
                            </div>
                            <p class="text-[10px] text-slate-400 mt-2 font-en">21 Sep 2025</p>
                        </div>

                        <!-- Event 2 (Previous) -->
                        <div class="relative opacity-60">
                            <div class="absolute top-1.5 -left-[31px] rtl:left-auto rtl:-right-[31px] w-4 h-4 bg-slate-300 rounded-full border-4 border-white dark:border-slate-800"></div>
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-bold text-sm text-slate-800 dark:text-white" data-i18n="evt2Title">Ø²ÙŠØ§Ø¯Ø© Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ (Ø§Ù„Ø³Ø§Ø¨Ù‚)</h4>
                                    <p class="text-xs text-slate-500 mt-1" data-i18n="evt2Desc">Ø±ÙØ¹ Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ Ù„Ø¯Ø¹Ù… Ø§Ù„ØªÙˆØ³Ø¹.</p>
                                </div>
                                <span class="bg-slate-100 text-slate-500 px-2 py-1 rounded text-[10px] font-bold font-en line-through">12,000,000 SAR</span>
                            </div>
                            <p class="text-[10px] text-slate-400 mt-2 font-en">2021</p>
                        </div>
                    </div>

                    <div class="mt-8 pt-4 border-t border-slate-100 dark:border-slate-700 flex gap-3">
                        <button class="text-xs flex items-center gap-2 text-brandBlue hover:underline"><i class="fa-solid fa-file-pdf"></i> <span data-i18n="docBylaw">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ (Ù†Ø³Ø®Ø© 3)</span></button>
                        <button class="text-xs flex items-center gap-2 text-brandBlue hover:underline"><i class="fa-solid fa-file-pdf"></i> <span data-i18n="docReg">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ† Ø§Ù„Ø±Ø³Ù…ÙŠ</span></button>
                    </div>
                </div>

            </div>

            <!-- 3. Registry Table -->
            <div class="bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                <div class="p-5 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-slate-200 text-slate-600 rounded-lg flex items-center justify-center"><i class="fa-solid fa-table-list"></i></div>
                        <div>
                            <h3 class="font-bold text-slate-800 dark:text-white" data-i18n="tableTitle">Ø³Ø¬Ù„ Ø§Ù„Ù…Ù„Ø§Ùƒ ÙˆØ§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ†</h3>
                            <p class="text-xs text-slate-500" data-i18n="tableSub">Ù…Ø­Ø¯Ø« Ø¨ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="..." class="bg-white border border-slate-200 rounded-lg px-3 py-1.5 text-xs w-48 focus:ring-1 focus:ring-brandBlue outline-none" data-i18n-placeholder="searchPlh">
                        <button onclick="window.print()" class="bg-slate-800 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-black transition"><i class="fa-solid fa-print"></i> <span data-i18n="btnPrint">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø³Ø¬Ù„</span></button>
                        <button onclick="exportCSV()" class="bg-green-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-green-700 transition"><i class="fa-solid fa-file-excel"></i> Excel</button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-right rtl:text-right ltr:text-left" id="registryTable">
                        <thead class="bg-slate-100 dark:bg-slate-700 text-xs font-bold text-slate-500 uppercase">
                            <tr>
                                <th class="p-4" data-i18n="colName">Ø§Ù„Ø§Ø³Ù…</th>
                                <th class="p-4" data-i18n="colRole">Ø§Ù„ØªÙ…Ø«ÙŠÙ„</th>
                                <th class="p-4" data-i18n="colNat">Ø§Ù„Ø¬Ù†Ø³ÙŠØ©</th>
                                <th class="p-4 text-left rtl:text-left ltr:text-right" data-i18n="colShares">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù…</th>
                                <th class="p-4 text-left rtl:text-left ltr:text-right" data-i18n="colPerc">Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                                <th class="p-4 text-left rtl:text-left ltr:text-right" data-i18n="colVal">Ø§Ù„Ù‚ÙŠÙ…Ø© (SAR)</th>
                                <th class="p-4 text-center" data-i18n="colAction">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100 dark:divide-slate-700" id="tableBody">
                            <!-- Rows generated by JS -->
                        </tbody>
                    </table>
                </div>
                
                <div class="p-4 bg-slate-50 dark:bg-slate-900 border-t border-slate-100 dark:border-slate-700 text-xs text-center text-slate-400" data-i18n="tblFooter">
                    Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 600,000 Ø³Ù‡Ù… | 100% Ù…Ù„ÙƒÙŠØ©
                </div>
            </div>

        </main>
    </div>

    <!-- Shareholder Details Modal -->
    <div id="shareholderModal" class="fixed inset-0 bg-black/60 hidden z-50 flex items-center justify-center backdrop-blur-sm no-print">
        <div class="bg-white dark:bg-slate-800 w-full max-w-md rounded-2xl shadow-xl p-6 transform transition-all scale-100">
            <div class="flex justify-between items-start mb-4 border-b border-slate-100 dark:border-slate-700 pb-3">
                <div>
                    <h3 class="font-bold text-lg text-slate-800 dark:text-white" id="modalName">Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ù‡Ù…</h3>
                    <p class="text-xs text-slate-500" id="modalRole">Ø§Ù„ØµÙØ©</p>
                </div>
                <button onclick="closeModal()" class="text-slate-400 hover:text-red-500"><i class="fa-solid fa-xmark"></i></button>
            </div>
            
            <div class="space-y-3 text-sm">
                <div class="flex justify-between p-2 bg-slate-50 dark:bg-slate-700 rounded">
                    <span class="text-slate-500" data-i18n="modShares">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù…</span>
                    <span class="font-bold font-en" id="modalShares">0</span>
                </div>
                <div class="flex justify-between p-2 bg-slate-50 dark:bg-slate-700 rounded">
                    <span class="text-slate-500" data-i18n="modPerc">Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ©</span>
                    <span class="font-bold font-en text-brandBlue" id="modalPercent">0%</span>
                </div>
                <div class="flex justify-between p-2 bg-slate-50 dark:bg-slate-700 rounded">
                    <span class="text-slate-500" data-i18n="modVal">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø³Ù…ÙŠØ©</span>
                    <span class="font-bold font-en text-green-600" id="modalValue">0</span>
                </div>
                
                <div class="mt-4">
                    <p class="text-xs font-bold text-slate-500 mb-2" data-i18n="modProxyTitle">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ…Ø«ÙŠÙ„ / Ø§Ù„ÙˆÙƒØ§Ù„Ø©</p>
                    <div class="p-3 border border-dashed border-slate-300 rounded-lg text-xs text-slate-600" id="modalProxy">
                        -
                    </div>
                </div>

                <div class="mt-4">
                    <p class="text-xs font-bold text-slate-500 mb-2" data-i18n="modContact">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</p>
                    <div class="flex items-center gap-2 text-xs text-slate-600">
                        <i class="fa-solid fa-envelope text-slate-400"></i> <span id="modalEmail" class="font-en">-</span>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 flex gap-2">
                <button class="flex-1 py-2 bg-brandBlue text-white rounded-lg text-xs font-bold hover:bg-blue-700" data-i18n="btnUpdate">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                <button onclick="closeModal()" class="px-4 py-2 border rounded-lg text-xs font-bold hover:bg-slate-50" data-i18n="btnClose">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <!-- AndroBot Widget (AI Assistant) -->
    <div id="andro-bot-container" class="fixed bottom-6 left-6 z-50 flex flex-col items-start gap-4 font-sans" dir="rtl">
        <!-- Chat Window -->
        <div id="chat-window" class="hidden bg-white dark:bg-slate-800 w-80 md:w-96 rounded-2xl shadow-2xl border border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col chat-window-anim" style="height: 500px; max-height: 70vh;">
            <div class="bg-brandBlue p-4 flex justify-between items-center text-white">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center"><i class="fa-solid fa-robot"></i></div>
                    <div><h4 class="font-bold text-sm">AndroBot</h4><p class="text-[10px] text-white/80">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø°ÙƒÙŠ</p></div>
                </div>
                <button id="close-chat-btn" class="text-white/80 hover:text-white transition"><i class="fa-solid fa-times"></i></button>
            </div>
            <div id="chat-body" class="flex-1 p-4 bg-slate-50 dark:bg-slate-900/50 overflow-y-auto custom-scroll space-y-3 flex flex-col">
                <div class="chat-bubble bot">Ù…Ø±Ø­Ø¨Ø§Ù‹ ğŸ‘‹<br>Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ. ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù† ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†Ø³Ø¨ØŒ ÙƒØ¨Ø§Ø± Ø§Ù„Ù…Ù„Ø§ÙƒØŒ Ø£Ùˆ Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„.</div>
                <div class="flex flex-wrap gap-2 mt-2" id="suggestions">
                    <button class="suggestion-btn text-xs bg-white border border-brandBlue/30 text-brandBlue px-3 py-1.5 rounded-full" data-q="Ù…Ù† ÙŠÙ…Ù„Ùƒ Ø£Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø©ØŸ">Ù…Ù† ÙŠÙ…Ù„Ùƒ Ø£Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø©ØŸ</button>
                    <button class="suggestion-btn text-xs bg-white border border-brandBlue/30 text-brandBlue px-3 py-1.5 rounded-full" data-q="ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù…ØŸ">ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù…ØŸ</button>
                </div>
            </div>
            <div class="p-3 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 flex gap-2">
                <input type="text" id="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ..." class="flex-1 bg-slate-100 dark:bg-slate-900 border-none rounded-lg text-sm px-4 py-2 focus:ring-2 focus:ring-brandBlue outline-none dark:text-white">
                <button id="send-btn" class="w-10 h-10 rounded-lg bg-brandBlue text-white hover:bg-blue-700 transition flex items-center justify-center"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>
        <!-- Floating Button -->
        <button id="chat-fab" class="w-14 h-14 bg-brandBlue hover:bg-blue-700 text-white rounded-full shadow-lg shadow-blue-600/30 flex items-center justify-center text-2xl transition-all transform hover:scale-110 active:scale-95 animate-bounce-slow">
            <i class="fa-solid fa-comment-dots"></i>
            <span class="absolute top-0 right-0 w-4 h-4 bg-brandRed rounded-full border-2 border-white dark:border-slate-900"></span>
        </button>
    </div>

    <script src="layout.js"></script>
    <script src="bot.js"></script>

    <script>
        // --- Translation Dictionary ---
        const t = {
            ar: {
                pageTitle: "AndroGov | Ø³Ø¬Ù„ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ†",
                kpiCapital: "Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ",
                paidFull: "Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„",
                kpiShares: "Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ù…ØµØ¯Ø±Ø©",
                shareUnit: "Ø³Ù‡Ù…",
                parValue: "Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³Ù…ÙŠØ©",
                kpiCount: "Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ†",
                chartTitle: "Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ù„ÙƒÙŠØ©",
                chartHeirs: "Ø§Ù„ÙˆØ±Ø«Ø©",
                chartBG: "Ø¨ÙŠØ¬ÙŠ",
                chartHesham: "Ù‡Ø´Ø§Ù…",
                chartOthers: "Ø¢Ø®Ø±ÙˆÙ†",
                histTitle: "Ø³Ø¬Ù„ Ø§Ù„ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„",
                evt1Title: "ØªØ®ÙÙŠØ¶ Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ (Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ)",
                evt1Desc: "Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù‚Ø±Ø§Ø± Ø§Ù„Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© ØºÙŠØ± Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© (Ø¥Ø·ÙØ§Ø¡ Ø®Ø³Ø§Ø¦Ø±).",
                evt2Title: "Ø²ÙŠØ§Ø¯Ø© Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ (Ø§Ù„Ø³Ø§Ø¨Ù‚)",
                evt2Desc: "Ø±ÙØ¹ Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ Ù„Ø¯Ø¹Ù… Ø§Ù„ØªÙˆØ³Ø¹.",
                docBylaw: "Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ (Ù†Ø³Ø®Ø© 3)",
                docReg: "Ø³Ø¬Ù„ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ† Ø§Ù„Ø±Ø³Ù…ÙŠ",
                tableTitle: "Ø³Ø¬Ù„ Ø§Ù„Ù…Ù„Ø§Ùƒ ÙˆØ§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ†",
                tableSub: "Ù…Ø­Ø¯Ø« Ø¨ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…",
                searchPlh: "Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…...",
                btnPrint: "Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø³Ø¬Ù„",
                colName: "Ø§Ù„Ø§Ø³Ù…",
                colRole: "Ø§Ù„ØªÙ…Ø«ÙŠÙ„",
                colNat: "Ø§Ù„Ø¬Ù†Ø³ÙŠØ©",
                colShares: "Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù…",
                colPerc: "Ø§Ù„Ù†Ø³Ø¨Ø©",
                colVal: "Ø§Ù„Ù‚ÙŠÙ…Ø© (SAR)",
                colAction: "Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª",
                tblFooter: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 600,000 Ø³Ù‡Ù… | 100% Ù…Ù„ÙƒÙŠØ©",
                modShares: "Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù…",
                modPerc: "Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ©",
                modVal: "Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø³Ù…ÙŠØ©",
                modProxyTitle: "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ…Ø«ÙŠÙ„ / Ø§Ù„ÙˆÙƒØ§Ù„Ø©",
                modContact: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„",
                btnUpdate: "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
                btnClose: "Ø¥ØºÙ„Ø§Ù‚",
                rolePrincipal: "Ø£ØµÙŠÙ„",
                roleProxy: "ÙˆÙƒØ§Ù„Ø©",
                natSaudi: "Ø³Ø¹ÙˆØ¯ÙŠ"
            },
            en: {
                pageTitle: "AndroGov | Shareholders Registry",
                kpiCapital: "Current Capital",
                paidFull: "Fully Paid",
                kpiShares: "Issued Shares",
                shareUnit: "Shares",
                parValue: "Par Value",
                kpiCount: "Shareholders Count",
                chartTitle: "Ownership Structure",
                chartHeirs: "Heirs",
                chartBG: "BG LTD",
                chartHesham: "Hesham",
                chartOthers: "Others",
                histTitle: "Capital History Log",
                evt1Title: "Capital Reduction (Current)",
                evt1Desc: "Based on EGA resolution (Loss absorption).",
                evt2Title: "Capital Increase (Previous)",
                evt2Desc: "Capital hike to support expansion.",
                docBylaw: "Bylaws (Ver 3)",
                docReg: "Official Shareholder Registry",
                tableTitle: "Owners & Shareholders Registry",
                tableSub: "Updated Today",
                searchPlh: "Search by name...",
                btnPrint: "Print Registry",
                colName: "Name",
                colRole: "Representation",
                colNat: "Nationality",
                colShares: "Shares",
                colPerc: "Percent",
                colVal: "Value (SAR)",
                colAction: "Actions",
                tblFooter: "Total: 600,000 Shares | 100% Ownership",
                modShares: "Shares Count",
                modPerc: "Ownership %",
                modVal: "Par Value",
                modProxyTitle: "Representation / Proxy Data",
                modContact: "Contact Info",
                btnUpdate: "Update Data",
                btnClose: "Close",
                rolePrincipal: "Principal",
                roleProxy: "Proxy",
                natSaudi: "Saudi"
            }
        };

        // --- Data Source ---
        const shareholders = [
            { id: 1, nameAr: "ÙˆØ±Ø«Ø© Ù…Ø­Ù…Ø¯ Ø¨Ù† ØµØ§Ù„Ø­ Ø§Ù„Ø³Ø­ÙŠØ¨Ø§Ù†ÙŠ", nameEn: "Heirs of Mohammed Al-Suhaibani", role: "major", proxyAr: "ÙˆÙƒØ§Ù„Ø© (ÙˆØ§Ø¦Ù„ Ø§Ù„Ø³Ø­ÙŠØ¨Ø§Ù†ÙŠ)", proxyEn: "Proxy (Wael Al-Suhaibani)", shares: 210000, percent: 35, email: "alcaseer@gmail.com" },
            { id: 2, nameAr: "Ø´Ø±ÙƒØ© Ø¨ÙŠØ¬ÙŠ Ø§Ù„Ù…Ø­Ø¯ÙˆØ¯Ø©", nameEn: "BG LTD Company", role: "comp", proxyAr: "ÙˆÙƒØ§Ù„Ø© (ØµØ§Ù„Ø­ Ø§Ù„Ø³Ø­ÙŠØ¨Ø§Ù†ÙŠ)", proxyEn: "Proxy (Saleh Al-Suhaibani)", shares: 90000, percent: 15, email: "info@begi.sa" },
            { id: 3, nameAr: "Ù‡Ø´Ø§Ù… Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø­ÙŠØ¨Ø§Ù†ÙŠ", nameEn: "Hesham Al-Suhaibani", role: "prin", proxyAr: "Ø£ØµÙŠÙ„", proxyEn: "Principal", shares: 60000, percent: 10, email: "hesham@androomeda.com" },
            { id: 4, nameAr: "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ø­ÙˆØ§Ø³", nameEn: "Abdullah Al-Hawas", role: "prin", proxyAr: "Ø£ØµÙŠÙ„", proxyEn: "Principal", shares: 30000, percent: 5, email: "abdullah@example.com" },
            { id: 5, nameAr: "Ù…Ù†ØµÙˆØ± Ø¨Ù† Ø­Ø³Ù† Ø§Ù„ÙŠØ§Ù…ÙŠ", nameEn: "Mansour Al-Yami", role: "prin", proxyAr: "Ø£ØµÙŠÙ„", proxyEn: "Principal", shares: 30000, percent: 5, email: "mansour@androomeda.com" },
            { id: 6, nameAr: "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¨Ù† Ø­Ù…Ø¯ Ø§Ù„Ø³ÙƒÙŠØªÙŠ", nameEn: "Ibrahim Al-Skaiti", role: "prin", proxyAr: "Ø£ØµÙŠÙ„", proxyEn: "Principal", shares: 30000, percent: 5, email: "iskaity@androomeda.com" },
            { id: 7, nameAr: "ÙˆØ§Ø¦Ù„ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø­ÙŠØ¨Ø§Ù†ÙŠ", nameEn: "Wael Al-Suhaibani", role: "prin", proxyAr: "Ø£ØµÙŠÙ„", proxyEn: "Principal", shares: 30000, percent: 5, email: "wael@live.com" },
            { id: 8, nameAr: "Ù‡ÙŠØ«Ù… Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø­ÙŠØ¨Ø§Ù†ÙŠ", nameEn: "Haitham Al-Suhaibani", role: "prin", proxyAr: "Ø£ØµÙŠÙ„", proxyEn: "Principal", shares: 30000, percent: 5, email: "haitham@gmail.com" },
            { id: 9, nameAr: "Ø£Ø­Ù…Ø¯ Ø¨Ù† Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø¬Ø§Ø³Ø±", nameEn: "Ahmed Al-Jasser", role: "prin", proxyAr: "Ø£ØµÙŠÙ„", proxyEn: "Principal", shares: 30000, percent: 5, email: "ahmed@gmail.com" },
            { id: 10, nameAr: "ØµØ§Ù„Ø­ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ù„ÙˆÙ‡ÙŠØ¨ÙŠ", nameEn: "Saleh Al-Wahaibi", role: "prin", proxyAr: "Ø£ØµÙŠÙ„", proxyEn: "Principal", shares: 30000, percent: 5, email: "saleh@gmail.com" },
            { id: 11, nameAr: "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠ Ø§Ù„ÙØ±ÙŠØ¬ÙŠ", nameEn: "Abdullah Al-Fariji", role: "prin", proxyAr: "Ø£ØµÙŠÙ„", proxyEn: "Principal", shares: 30000, percent: 5, email: "alfraiji@gmail.com" }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            updatePageLanguage();
        });

        function updatePageLanguage() {
            const lang = localStorage.getItem('lang') || 'ar';
            const dict = t[lang];
            
            // Document Direction
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            // Static Text
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(dict[key]) el.innerText = dict[key];
            });

            // Placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if(dict[key]) el.placeholder = dict[key];
            });

            // Update Table
            renderTable(shareholders);
            
            // Update Chart
            initChart(lang);

            // Update Date
            const date = new Date().toLocaleDateString(lang === 'ar' ? 'ar-SA' : 'en-US');
            document.getElementById('printDate').innerText = date;
        }

        // --- Render Table ---
        function renderTable(data) {
            const lang = localStorage.getItem('lang') || 'ar';
            const dict = t[lang];
            const tbody = document.getElementById('tableBody');
            
            tbody.innerHTML = data.map(s => {
                const name = lang === 'ar' ? s.nameAr : s.nameEn;
                const proxy = lang === 'ar' ? s.proxyAr : s.proxyEn;
                const nat = dict.natSaudi;
                const proxyBadge = s.role === 'prin' 
                    ? `<span class="bg-slate-100 px-2 py-1 rounded">${proxy}</span>` 
                    : `<span class="bg-purple-50 text-purple-700 px-2 py-1 rounded font-bold">${proxy}</span>`;

                return `
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition border-b border-slate-100 dark:border-slate-700 group">
                    <td class="p-4 font-bold text-slate-800 dark:text-slate-200">${name}</td>
                    <td class="p-4 text-xs text-slate-500">${proxyBadge}</td>
                    <td class="p-4 text-xs">${nat}</td>
                    <td class="p-4 font-mono text-left rtl:text-left ltr:text-right font-bold">${s.shares.toLocaleString()}</td>
                    <td class="p-4 font-mono text-left rtl:text-left ltr:text-right text-brandBlue font-bold">${s.percent}%</td>
                    <td class="p-4 font-mono text-left rtl:text-left ltr:text-right text-slate-500">${(s.shares * 10).toLocaleString()}</td>
                    <td class="p-4 text-center">
                        <button onclick="openModal(${s.id})" class="text-slate-400 hover:text-brandBlue transition group-hover:scale-110"><i class="fa-solid fa-circle-info text-lg"></i></button>
                    </td>
                </tr>`;
            }).join('');
        }

        // --- Search Filter ---
        function filterTable() {
            const lang = localStorage.getItem('lang') || 'ar';
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = shareholders.filter(s => {
                const name = lang === 'ar' ? s.nameAr : s.nameEn;
                return name.toLowerCase().includes(query);
            });
            renderTable(filtered);
        }

        // --- Chart ---
        let myChart = null;
        function initChart(lang) {
            const dict = t[lang];
            const ctx = document.getElementById('sharesChart').getContext('2d');
            
            if(myChart) myChart.destroy();

            // Legend
            const legendDiv = document.getElementById('chartLegend');
            legendDiv.innerHTML = `
                <div class="flex justify-between text-xs">
                    <span class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-brandRed"></span> ${dict.chartHeirs}</span>
                    <span class="font-en font-bold">35%</span>
                </div>
                <div class="flex justify-between text-xs">
                    <span class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-blue-500"></span> ${dict.chartBG}</span>
                    <span class="font-en font-bold">15%</span>
                </div>
                <div class="flex justify-between text-xs">
                    <span class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-green-500"></span> ${dict.chartHesham}</span>
                    <span class="font-en font-bold">10%</span>
                </div>
                <div class="flex justify-between text-xs">
                    <span class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-slate-300"></span> ${dict.chartOthers}</span>
                    <span class="font-en font-bold">40%</span>
                </div>
            `;

            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [dict.chartHeirs, dict.chartBG, dict.chartHesham, dict.chartOthers],
                    datasets: [{
                        data: [35, 15, 10, 40],
                        backgroundColor: ['#FB4747', '#3B82F6', '#10B981', '#CBD5E1'],
                        borderWidth: 0,
                        hoverOffset: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    cutout: '70%'
                }
            });
        }

        // --- Modal Logic ---
        function openModal(id) {
            const lang = localStorage.getItem('lang') || 'ar';
            const s = shareholders.find(x => x.id === id);
            if (!s) return;
            
            document.getElementById('modalName').innerText = lang === 'ar' ? s.nameAr : s.nameEn;
            document.getElementById('modalRole').innerText = lang === 'ar' ? s.proxyAr : s.proxyEn;
            document.getElementById('modalShares').innerText = s.shares.toLocaleString();
            document.getElementById('modalPercent').innerText = s.percent + '%';
            document.getElementById('modalValue').innerText = (s.shares * 10).toLocaleString() + ' SAR';
            document.getElementById('modalProxy').innerText = lang === 'ar' ? s.proxyAr : s.proxyEn;
            document.getElementById('modalEmail').innerText = s.email || '-';
            
            document.getElementById('shareholderModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('shareholderModal').classList.add('hidden');
        }

        function exportCSV() {
            alert("Exporting CSV...");
        }

        // --- Custom AI Override for Registry Context ---
        const originalGetAIResponse = window.getAIResponse; 
        
        window.getAIResponse = function(query, isArabic) {
            const q = query.toLowerCase();
            
            // Highest Shareholder
            if (q.includes('most') || q.includes('major') || q.includes('Ø£ÙƒØ¨Ø±') || q.includes('Ù†Ø³Ø¨Ø©')) {
                return isArabic
                    ? `Ø£ÙƒØ¨Ø± Ø§Ù„Ù…Ù„Ø§Ùƒ Ù‡Ù… <b>ÙˆØ±Ø«Ø© Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø­ÙŠØ¨Ø§Ù†ÙŠ</b> Ø¨Ù†Ø³Ø¨Ø© 35% (210,000 Ø³Ù‡Ù…).`
                    : `The major shareholders are <b>Heirs of Al-Suhaibani</b> with 35% (210,000 shares).`;
            }
            
            // Total Shares
            if (q.includes('total') || q.includes('count') || q.includes('Ø¹Ø¯Ø¯') || q.includes('Ù…Ø¬Ù…ÙˆØ¹')) {
                return isArabic
                    ? `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ù…ØµØ¯Ø±Ø© Ù‡Ùˆ <b>600,000 Ø³Ù‡Ù…</b>.`
                    : `Total issued shares: <b>600,000 shares</b>.`;
            }

            // Default fallback logic from bot.js will act if no specific match, or simple default here
            return isArabic
                ? `ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø¹Ù†: <b>Ø£ÙƒØ¨Ø± Ø§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ†</b>ØŒ Ø£Ùˆ <b>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ù‡Ù…</b>.`
                : `I can answer about: <b>Major Shareholders</b> or <b>Total Shares</b>.`;
        }

    </script>
      
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function () {
      navigator.serviceWorker
        .register('service-worker.js')
        .catch(function (err) {
          console.warn('Service worker registration failed:', err);
        });
    });
  }
</script>
</body>
</html>
