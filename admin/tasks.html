<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AndroGov | إدارة المهام</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css"> <!-- الملف الجديد -->
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-brandGray dark:bg-slate-900 text-slate-800 dark:text-slate-100 font-sans h-screen flex overflow-hidden opacity-0">

    <!-- Containers populated by layout.js -->
    <div id="sidebar-container"></div>

    <div class="main-content-wrapper flex-1 flex flex-col md:mr-72 transition-all">
        <div id="header-container"></div>

        <!-- Task Toolbar -->
        <div class="h-16 flex items-center justify-between px-6 bg-white dark:bg-[#1E293B] border-b border-slate-200 dark:border-slate-700">
            <div class="flex items-center gap-4">
                <h2 class="text-lg font-bold flex items-center gap-2">
                    <i class="fa-solid fa-list-check text-brandBlue"></i> مركز المهام
                </h2>
                <div class="flex bg-slate-100 dark:bg-slate-700 rounded-lg p-1">
                    <button id="btn-board" onclick="switchView('board')" class="px-3 py-1 bg-white dark:bg-slate-600 shadow-sm rounded-md text-xs font-bold transition text-brandBlue">لوحة</button>
                    <button id="btn-list" onclick="switchView('list')" class="px-3 py-1 text-slate-500 dark:text-slate-400 text-xs font-bold hover:text-brandBlue transition">قائمة</button>
                </div>
            </div>
            <button onclick="newTask()" class="bg-brandBlue text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-blue-700 transition">
                <i class="fa-solid fa-plus"></i> مهمة جديدة
            </button>
        </div>

        <!-- Kanban Board Area -->
        <main class="flex-1 overflow-x-auto p-6">
            <div id="board-container" class="flex gap-6 h-full min-w-[1000px] transition-all">
                
                <!-- Columns -->
                <div class="flex-1 bg-slate-100 dark:bg-slate-800/50 rounded-2xl flex flex-col border border-slate-200 dark:border-slate-700/50 board-col">
                    <div class="p-4 flex justify-between items-center border-b border-slate-200 dark:border-slate-700 border-b-4 border-slate-400 col-header">
                        <span class="font-bold text-sm">قيد الانتظار</span>
                        <span id="count-todo" class="bg-white dark:bg-slate-700 px-2 py-0.5 rounded-full text-xs font-bold shadow-sm">0</span>
                    </div>
                    <div id="col-todo" class="flex-1 p-3 space-y-3 overflow-y-auto custom-scroll task-body"></div>
                </div>

                <div class="flex-1 bg-blue-50 dark:bg-blue-900/10 rounded-2xl flex flex-col border border-blue-100 dark:border-slate-700/50 board-col">
                    <div class="p-4 flex justify-between items-center border-b border-blue-200 dark:border-slate-700 border-b-4 border-blue-400 col-header">
                        <span class="font-bold text-sm text-blue-900 dark:text-blue-100">جاري التنفيذ</span>
                        <span id="count-progress" class="bg-white dark:bg-slate-700 px-2 py-0.5 rounded-full text-xs font-bold shadow-sm">0</span>
                    </div>
                    <div id="col-progress" class="flex-1 p-3 space-y-3 overflow-y-auto custom-scroll task-body"></div>
                </div>

                <div class="flex-1 bg-orange-50 dark:bg-orange-900/10 rounded-2xl flex flex-col border border-orange-100 dark:border-slate-700/50 board-col">
                    <div class="p-4 flex justify-between items-center border-b border-orange-200 dark:border-slate-700 border-b-4 border-orange-400 col-header">
                        <span class="font-bold text-sm text-orange-900 dark:text-orange-100">تحت المراجعة</span>
                        <span id="count-review" class="bg-white dark:bg-slate-700 px-2 py-0.5 rounded-full text-xs font-bold shadow-sm">0</span>
                    </div>
                    <div id="col-review" class="flex-1 p-3 space-y-3 overflow-y-auto custom-scroll task-body"></div>
                </div>

                <div class="flex-1 bg-green-50 dark:bg-green-900/10 rounded-2xl flex flex-col border border-green-100 dark:border-slate-700/50 board-col">
                    <div class="p-4 flex justify-between items-center border-b border-green-200 dark:border-slate-700 border-b-4 border-green-400 col-header">
                        <span class="font-bold text-sm text-green-900 dark:text-green-100">مكتمل</span>
                        <span id="count-done" class="bg-white dark:bg-slate-700 px-2 py-0.5 rounded-full text-xs font-bold shadow-sm text-green-600">0</span>
                    </div>
                    <div id="col-done" class="flex-1 p-3 space-y-3 overflow-y-auto custom-scroll task-body"></div>
                </div>

            </div>
        </main>
    </div>

    <!-- Bot Container -->
    <div id="andro-bot-container" class="fixed bottom-6 left-6 z-50 flex flex-col items-start gap-4" dir="rtl"></div>

    <!-- Core Scripts -->
    <script src="layout.js"></script>
    <script src="bot.js"></script>

    <!-- Page Specific Script -->
    <script>
        const tasksData = [
            { id: 1, title: 'اعتماد سياسة المكافآت', desc: 'مراجعة المسودة النهائية.', tag: 'Gov', color: 'bg-yellow-100 text-yellow-700', status: 'col-todo', urgent: true },
            { id: 2, title: 'تحديث السجل التجاري', desc: 'إضافة نشاط جديد.', tag: 'Legal', color: 'bg-purple-100 text-purple-700', status: 'col-todo' },
            { id: 3, title: 'مراجعة تقرير الرواتب', desc: 'التأكد من الخصومات.', tag: 'Ops', color: 'bg-blue-100 text-blue-700', status: 'col-progress' },
            { id: 4, title: 'عقود التوظيف', desc: 'بانتظار توقيع الرئيس.', tag: 'HR', color: 'bg-pink-100 text-pink-700', status: 'col-review' },
            { id: 5, title: 'أرشفة المحاضر', desc: 'محاضر الربع الرابع.', tag: 'Board', color: 'bg-green-100 text-green-700', status: 'col-done', done: true }
        ];

        function renderTasks() {
            // Clear
            ['col-todo', 'col-progress', 'col-review', 'col-done'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });

            tasksData.forEach(task => {
                const html = `
                <div class="bg-white dark:bg-slate-700 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-600 task-card group ${task.done ? 'opacity-60' : ''}">
                    <div class="flex justify-between items-start mb-2">
                        <span class="${task.color} text-[10px] font-bold px-2 py-0.5 rounded">${task.tag}</span>
                        ${task.urgent ? '<span class="text-[10px] bg-red-100 text-red-600 px-2 py-0.5 rounded-full animate-pulse">عاجل</span>' : ''}
                    </div>
                    <h4 class="font-bold text-sm mb-1 dark:text-white">${task.title}</h4>
                    <p class="text-[11px] text-slate-500 dark:text-slate-400 line-clamp-2">${task.desc}</p>
                    <div class="mt-3 flex justify-between items-center">
                        <img src="${SYSTEM_DATA.currentUser.avatar}" class="w-6 h-6 rounded-full border-2 border-white dark:border-slate-700">
                        <button class="text-slate-300 hover:text-slate-500"><i class="fa-solid fa-ellipsis"></i></button>
                    </div>
                </div>`;
                document.getElementById(task.status).insertAdjacentHTML('beforeend', html);
            });
            
            // Update Counts
            ['col-todo', 'col-progress', 'col-review', 'col-done'].forEach(id => {
                const countId = 'count-' + id.split('-')[1];
                const count = document.getElementById(id).children.length;
                if(document.getElementById(countId)) document.getElementById(countId).innerText = count;
            });
        }

        // Drag & Drop
        document.addEventListener('DOMContentLoaded', () => {
            renderTasks();
            ['col-todo', 'col-progress', 'col-review', 'col-done'].forEach(id => {
                new Sortable(document.getElementById(id), {
                    group: 'shared', animation: 150, ghostClass: 'bg-slate-200',
                    onEnd: () => { 
                        // Logic to update tasksData array based on new position would go here
                        // For UI demo, just updating counts is enough
                        ['col-todo', 'col-progress', 'col-review', 'col-done'].forEach(cid => {
                             const countId = 'count-' + cid.split('-')[1];
                             const count = document.getElementById(cid).children.length;
                             if(document.getElementById(countId)) document.getElementById(countId).innerText = count;
                        });
                    }
                });
            });
        });

        // View Switcher
        window.switchView = (mode) => {
            const container = document.getElementById('board-container');
            const btnBoard = document.getElementById('btn-board');
            const btnList = document.getElementById('btn-list');
            
            if (mode === 'list') {
                container.classList.add('list-view');
                container.classList.remove('flex', 'gap-6', 'min-w-[1000px]');
                btnList.classList.add('bg-white', 'dark:bg-slate-600', 'shadow-sm', 'text-brandBlue');
                btnList.classList.remove('text-slate-500');
                btnBoard.classList.remove('bg-white', 'dark:bg-slate-600', 'shadow-sm', 'text-brandBlue');
                btnBoard.classList.add('text-slate-500');
            } else {
                container.classList.remove('list-view');
                container.classList.add('flex', 'gap-6', 'min-w-[1000px]');
                btnBoard.classList.add('bg-white', 'dark:bg-slate-600', 'shadow-sm', 'text-brandBlue');
                btnBoard.classList.remove('text-slate-500');
                btnList.classList.remove('bg-white', 'dark:bg-slate-600', 'shadow-sm', 'text-brandBlue');
                btnList.classList.add('text-slate-500');
            }
        };

        // New Task
        window.newTask = () => {
            Swal.fire({
                title: 'مهمة جديدة',
                input: 'text',
                inputPlaceholder: 'عنوان المهمة...',
                showCancelButton: true,
                confirmButtonText: 'إضافة',
                cancelButtonText: 'إلغاء',
                confirmButtonColor: '#4267B2'
            }).then((res) => {
                if (res.isConfirmed && res.value) {
                    tasksData.unshift({ id: Date.now(), title: res.value, desc: 'مهمة جديدة', tag: 'Gen', color: 'bg-gray-100', status: 'col-todo' });
                    renderTasks();
                    Swal.fire({ icon: 'success', title: 'تمت الإضافة', timer: 1500, showConfirmButton: false });
                }
            });
        };
    </script>
</body>
</html>
