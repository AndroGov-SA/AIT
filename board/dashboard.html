<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#FB4747">
    <title data-i18n="pageTitle">بوابة المجلس واللجان | AndroGov</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brandRed: '#FB4747',
                        brandBlue: '#4267B2',
                        brandDark: '#1E293B',
                        brandGray: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Tajawal', 'Inter', 'sans-serif'],
                        en: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        .num-font { font-family: 'Inter', sans-serif; direction: ltr; display: inline-block; }
        .sig-pad { background: #fff; border: 2px dashed #cbd5e1; cursor: crosshair; }
        /* Smooth transitions */
        body { transition: background-color 0.3s, color 0.3s; }
    </style>
</head>
<body class="bg-brandGray dark:bg-slate-900 text-slate-800 dark:text-slate-100 font-sans transition-colors duration-300">

    <nav class="bg-white dark:bg-slate-800 h-16 fixed w-full z-50 shadow-sm border-b border-slate-100 dark:border-slate-700 flex justify-between items-center px-6">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-brandRed rounded-lg flex items-center justify-center text-white font-bold"><i class="fa-solid fa-gavel"></i></div>
            <span class="font-bold text-lg text-slate-800 dark:text-white hidden md:block" data-i18n="portalName">بوابة القيادة</span>
        </div>
        
        <div class="hidden md:flex bg-slate-100 dark:bg-slate-700 rounded-lg p-1">
            <button class="px-4 py-1.5 text-xs font-bold rounded-md bg-white text-brandBlue shadow-sm" data-i18n="ctxBoard">مجلس الإدارة</button>
            <button class="px-4 py-1.5 text-xs font-bold rounded-md text-slate-500 hover:text-slate-700 dark:text-slate-400" data-i18n="ctxAudit">لجنة المراجعة</button>
        </div>

        <div class="flex items-center gap-3">
            <button onclick="toggleLang()" class="w-8 h-8 rounded-full border border-slate-200 dark:border-slate-600 flex items-center justify-center text-xs font-bold hover:bg-slate-50 dark:hover:bg-slate-700 transition">
                <span id="langLabel">EN</span>
            </button>

            <div class="flex items-center gap-3 bg-slate-50 dark:bg-slate-700 px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-600">
                <img id="userAvatar" src="" class="w-8 h-8 rounded-full object-cover">
                <div class="hidden md:block text-right rtl:text-right ltr:text-left">
                    <p class="text-xs font-bold text-slate-700 dark:text-white" id="userName">...</p>
                    <p class="text-[10px] text-slate-500 dark:text-slate-400" id="userRole">...</p>
                </div>
            </div>
            <button onclick="logout()" class="text-slate-400 hover:text-brandRed transition"><i class="fa-solid fa-power-off"></i></button>
        </div>
    </nav>

    <main class="pt-24 pb-12 px-4 md:px-8 max-w-7xl mx-auto space-y-8">

        <div class="flex justify-between items-end">
            <div>
                <h1 class="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
                    <span data-i18n="welcome">مرحباً،</span> <span id="welcomeName" class="text-brandBlue">...</span>
                </h1>
                <p class="text-sm text-slate-500 mt-1" data-i18n="statusMsg">إليك ملخص الأعمال والمهام المعلقة.</p>
            </div>
            <div id="secToolsBtn" class="hidden">
                <button onclick="toggleSecPanel()" class="bg-brandDark text-white px-4 py-2 rounded-xl text-xs font-bold shadow-lg flex items-center gap-2 hover:bg-slate-700 transition">
                    <i class="fa-solid fa-briefcase"></i> <span data-i18n="secTools">أدوات أمانة السر</span>
                </button>
            </div>
        </div>

        <div id="secPanel" class="hidden bg-slate-800 text-white p-6 rounded-2xl shadow-xl border border-slate-700 relative overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-10"><i class="fa-solid fa-feather-pointed text-8xl"></i></div>
            <h3 class="font-bold text-lg mb-4 flex items-center gap-2"><i class="fa-solid fa-pen-nib text-brandRed"></i> <span data-i18n="secPanelTitle">مركز إدارة الأمانة</span></h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 relative z-10">
                <button class="bg-white/10 hover:bg-white/20 p-4 rounded-xl text-center transition">
                    <i class="fa-solid fa-plus-circle text-2xl mb-2 text-green-400"></i>
                    <p class="text-xs font-bold" data-i18n="secNewMtg">دعوة اجتماع جديد</p>
                </button>
                <button class="bg-white/10 hover:bg-white/20 p-4 rounded-xl text-center transition">
                    <i class="fa-solid fa-file-signature text-2xl mb-2 text-blue-400"></i>
                    <p class="text-xs font-bold" data-i18n="secNewRes">إنشاء قرار بالتمرير</p>
                </button>
                <button class="bg-white/10 hover:bg-white/20 p-4 rounded-xl text-center transition">
                    <i class="fa-solid fa-upload text-2xl mb-2 text-purple-400"></i>
                    <p class="text-xs font-bold" data-i18n="secUploadDocs">رفع مسودات المحاضر</p>
                </button>
                <button class="bg-white/10 hover:bg-white/20 p-4 rounded-xl text-center transition">
                    <i class="fa-solid fa-bell text-2xl mb-2 text-yellow-400"></i>
                    <p class="text-xs font-bold" data-i18n="secRemind">تذكير الأعضاء بالتصويت</p>
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-2 space-y-8">
                
                <div class="bg-white dark:bg-slate-800 rounded-3xl p-8 relative overflow-hidden shadow-sm border border-slate-100 dark:border-slate-700">
                    <div class="flex justify-between items-start mb-6">
                        <span class="bg-brandRed/10 text-brandRed px-3 py-1 rounded-full text-xs font-bold animate-pulse" data-i18n="lblNextMtg">الاجتماع القادم</span>
                        <div class="text-center bg-slate-50 dark:bg-slate-700 p-2 rounded-lg border border-slate-100 dark:border-slate-600">
                            <span class="block text-xs text-slate-400" data-i18n="monthFeb">فبراير</span>
                            <span class="block text-2xl font-bold font-en text-slate-800 dark:text-white">15</span>
                        </div>
                    </div>
                    
                    <h2 class="text-2xl font-bold mb-2 text-slate-900 dark:text-white" data-i18n="mtgTitle">اجتماع مجلس الإدارة الربع سنوي (Q1)</h2>
                    <div class="flex items-center gap-6 text-sm text-slate-500 dark:text-slate-400 mb-8">
                        <span><i class="fa-regular fa-clock text-brandBlue"></i> <span class="num-font">10:00 AM</span></span>
                        <span><i class="fa-solid fa-location-dot text-brandBlue"></i> <span data-i18n="locHQ">المقر الرئيسي - قاعة الاجتماعات</span></span>
                    </div>

                    <div class="flex flex-wrap gap-3">
                        <button class="bg-brandBlue text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-700 transition flex items-center gap-2 shadow-lg shadow-blue-500/20 text-xs">
                            <i class="fa-solid fa-cloud-arrow-down"></i> <span data-i18n="btnPack">تحميل حزمة الاجتماع</span>
                        </button>
                        <button class="bg-green-50 text-green-600 border border-green-200 px-6 py-2.5 rounded-xl font-bold hover:bg-green-100 transition text-xs">
                            <i class="fa-solid fa-check"></i> <span data-i18n="btnConfirm">تأكيد الحضور</span>
                        </button>
                    </div>
                </div>

                <div>
                    <h3 class="font-bold text-lg text-slate-800 dark:text-white mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-file-signature text-brandRed"></i> <span data-i18n="voteTitle">قرارات تتطلب تصويتك</span>
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border-l-4 border-l-brandRed border-y border-r border-slate-100 dark:border-slate-700 flex flex-col md:flex-row justify-between items-center gap-4" id="vote-card-1">
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-[10px] bg-red-50 dark:bg-red-900/20 text-brandRed px-2 py-0.5 rounded font-bold" data-i18n="lblUrgent">عاجل</span>
                                    <span class="text-[10px] text-slate-400 font-en">REF: CIR-2026-02</span>
                                </div>
                                <h4 class="font-bold text-slate-800 dark:text-white" data-i18n="voteSubject1">تعيين مستشار قانوني للمجموعة</h4>
                                <a href="#" class="text-[10px] text-brandBlue underline mt-2 block" data-i18n="viewAttach">عرض المرفقات</a>
                            </div>
                            <div class="flex gap-2 w-full md:w-auto">
                                <button onclick="castVote(1, 'approve')" class="flex-1 md:flex-none px-4 py-2 bg-green-50 text-green-600 border border-green-200 rounded-lg text-xs font-bold hover:bg-green-600 hover:text-white transition" data-i18n="btnAgree">موافق</button>
                                <button onclick="castVote(1, 'reject')" class="flex-1 md:flex-none px-4 py-2 bg-red-50 text-brandRed border border-red-200 rounded-lg text-xs font-bold hover:bg-brandRed hover:text-white transition" data-i18n="btnDisagree">غير موافق</button>
                                <button onclick="castVote(1, 'abstain')" class="flex-1 md:flex-none px-4 py-2 bg-slate-50 text-slate-500 border border-slate-200 rounded-lg text-xs font-bold hover:bg-slate-200 transition" data-i18n="btnAbstain">ممتنع</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="space-y-6">
                
                <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <h3 class="font-bold text-sm text-slate-800 dark:text-white mb-4 border-b border-slate-100 dark:border-slate-700 pb-2" data-i18n="myMemberships">عضوياتي</h3>
                    <div class="space-y-3" id="committeesList">
                        </div>
                </div>

                <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <h3 class="font-bold text-sm text-slate-800 dark:text-white mb-4 border-b border-slate-100 dark:border-slate-700 pb-2" data-i18n="libTitle">المكتبة الرقمية</h3>
                    <div class="space-y-3">
                        <a href="#" class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-700 transition group border border-transparent hover:border-slate-100 dark:hover:border-slate-600">
                            <div class="w-8 h-8 bg-slate-100 dark:bg-slate-700 text-slate-500 rounded-lg flex items-center justify-center group-hover:bg-brandBlue group-hover:text-white transition"><i class="fa-solid fa-book"></i></div>
                            <div>
                                <p class="text-xs font-bold text-slate-700 dark:text-white" data-i18n="docBylaws">النظام الأساسي</p>
                                <p class="text-[10px] text-slate-400">PDF • 2.4 MB</p>
                            </div>
                        </a>
                        <a href="#" class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-700 transition group border border-transparent hover:border-slate-100 dark:hover:border-slate-600">
                            <div class="w-8 h-8 bg-slate-100 dark:bg-slate-700 text-slate-500 rounded-lg flex items-center justify-center group-hover:bg-brandBlue group-hover:text-white transition"><i class="fa-solid fa-scale-balanced"></i></div>
                            <div>
                                <p class="text-xs font-bold text-slate-700 dark:text-white" data-i18n="docGov">لائحة الحوكمة</p>
                                <p class="text-[10px] text-slate-400">PDF • 1.1 MB</p>
                            </div>
                        </a>
                    </div>
                </div>

            </div>

        </div>

    </main>

    <div id="signModal" class="fixed inset-0 bg-black/80 hidden z-50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white dark:bg-slate-800 w-full max-w-md rounded-2xl shadow-2xl p-6">
            <h3 class="font-bold text-lg mb-2 text-center dark:text-white" data-i18n="signTitle">تأكيد التصويت والتوقيع</h3>
            <p class="text-xs text-slate-500 dark:text-slate-400 text-center mb-4" data-i18n="signDesc">يرجى التوقيع أدناه لاعتماد تصويتك.</p>
            
            <div class="h-32 bg-slate-50 dark:bg-slate-700 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl mb-4 flex items-center justify-center relative group cursor-crosshair">
                <span class="text-slate-400 text-xs pointer-events-none group-hover:hidden" data-i18n="signHere">ارسم توقيعك هنا</span>
                <i class="fa-solid fa-pen-nib absolute top-2 right-2 text-slate-300"></i>
                <div class="w-full h-full" onclick="this.innerHTML='<div class=\'flex items-center justify-center h-full\'><img src=\'https://upload.wikimedia.org/wikipedia/commons/e/eb/John_Hancock_Signature.svg\' class=\'h-12 opacity-80 filter dark:invert\'></div>'"></div>
            </div>

            <div class="flex gap-2">
                <button onclick="document.getElementById('signModal').classList.add('hidden')" class="flex-1 py-2 border dark:border-slate-600 rounded-lg text-sm font-bold text-slate-600 dark:text-slate-300" data-i18n="cancel">إلغاء</button>
                <button onclick="confirmVote()" class="flex-1 py-2 bg-brandBlue text-white rounded-lg text-sm font-bold shadow-lg hover:bg-blue-700" data-i18n="btnConfirmSign">اعتماد وتوقيع</button>
            </div>
        </div>
    </div>

    <script src="../admin/data/company_policy.js"></script>
    <script src="../admin/js/core/config.js"></script>
    <script src="../admin/js/services/data-service.js"></script>

    <script>
        // Mock current user (Simulate different roles)
        // Change role to 'Secretary' to see Secretary Tools
        const currentUser = {
            name: "أ. أيمن المغربي",
            role: "Secretary", // Options: 'Board Member', 'Secretary', 'Committee Member'
            avatar: "https://ui-avatars.com/api/?name=Ayman+M&background=random"
        };

        // Current Language
        let currentLang = 'ar';

        document.addEventListener('DOMContentLoaded', () => {
            initPage();
        });

        function initPage() {
            // Set User Info
            document.getElementById('userName').innerText = currentUser.name;
            document.getElementById('welcomeName').innerText = currentUser.name.split(' ')[1]; 
            document.getElementById('userAvatar').src = currentUser.avatar;

            // Role Logic
            const roleKey = currentUser.role === 'Secretary' ? 'roleSec' : 'roleMember';
            document.getElementById('userRole').setAttribute('data-i18n', roleKey);
            
            // Show Secretary Tools if applicable
            if(currentUser.role === 'Secretary') {
                document.getElementById('secToolsBtn').classList.remove('hidden');
            }

            renderCommittees();
            updatePageLanguage();
        }

        function renderCommittees() {
            const list = document.getElementById('committeesList');
            // Mock Data
            const comms = [
                { nameAr: "مجلس الإدارة", nameEn: "Board of Directors", roleAr: "أمين السر", roleEn: "Secretary", color: "blue" },
                { nameAr: "لجنة المراجعة", nameEn: "Audit Committee", roleAr: "أمين اللجنة", roleEn: "Secretary", color: "purple" }
            ];

            list.innerHTML = comms.map(c => `
                <div class="p-3 bg-${c.color}-50 dark:bg-${c.color}-900/10 rounded-xl border border-${c.color}-100 dark:border-${c.color}-900/30 flex justify-between items-center">
                    <div>
                        <p class="text-xs font-bold text-${c.color}-800 dark:text-${c.color}-300 mb-1">${currentLang==='ar'?c.nameAr:c.nameEn}</p>
                        <p class="text-[10px] text-${c.color}-600 dark:text-${c.color}-400">${currentLang==='ar'?c.roleAr:c.roleEn}</p>
                    </div>
                    <i class="fa-solid fa-chevron-left rtl:rotate-0 ltr:rotate-180 text-${c.color}-400 text-xs"></i>
                </div>
            `).join('');
        }

        function toggleSecPanel() {
            document.getElementById('secPanel').classList.toggle('hidden');
        }

        // --- Voting Logic ---
        let activeCardId = null;
        function castVote(id, decision) {
            activeCardId = id;
            if (decision === 'approve') {
                document.getElementById('signModal').classList.remove('hidden');
            } else {
                alert(currentLang === 'ar' ? "تم تسجيل رأيك" : "Vote recorded");
                document.getElementById(`vote-card-${id}`).classList.add('opacity-50', 'pointer-events-none');
            }
        }

        function confirmVote() {
            document.getElementById('signModal').classList.add('hidden');
            const card = document.getElementById(`vote-card-${activeCardId}`);
            const msg = currentLang === 'ar' ? "تم التصويت بنجاح" : "Voted Successfully";
            const agree = currentLang === 'ar' ? "موافق" : "Agreed";
            
            card.innerHTML = `
                <div class="flex justify-between items-center w-full">
                    <div>
                        <h4 class="font-bold text-slate-600 dark:text-slate-300">${msg}</h4>
                        <p class="text-xs text-slate-400">REF: CIR-2026-02</p>
                    </div>
                    <span class="text-green-600 font-bold text-sm flex items-center gap-1"><i class="fa-solid fa-check-circle"></i> ${agree}</span>
                </div>
            `;
            card.classList.add('bg-slate-50', 'dark:bg-slate-700', 'opacity-80');
        }

        // --- I18n Engine ---
        function toggleLang() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            document.getElementById('langLabel').innerText = currentLang === 'ar' ? 'EN' : 'عربي';
            updatePageLanguage();
            renderCommittees(); // Re-render dynamic content
        }

        function updatePageLanguage() {
            const dict = t[currentLang];
            document.documentElement.lang = currentLang;
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(dict[key]) el.innerText = dict[key];
            });
        }

        function logout() {
            window.location.href = '../index.html';
        }

        const t = {
            ar: {
                pageTitle: "بوابة المجلس واللجان",
                portalName: "بوابة القيادة",
                ctxBoard: "مجلس الإدارة",
                ctxAudit: "لجنة المراجعة",
                roleSec: "أمين السر",
                roleMember: "عضو المجلس",
                welcome: "مرحباً،",
                statusMsg: "إليك ملخص الأعمال والمهام المعلقة.",
                secTools: "أدوات أمانة السر",
                secPanelTitle: "مركز إدارة الأمانة",
                secNewMtg: "دعوة اجتماع جديد",
                secNewRes: "إنشاء قرار بالتمرير",
                secUploadDocs: "رفع مسودات المحاضر",
                secRemind: "تذكير الأعضاء بالتصويت",
                lblNextMtg: "الاجتماع القادم",
                monthFeb: "فبراير",
                mtgTitle: "اجتماع مجلس الإدارة الربع سنوي (Q1)",
                locHQ: "المقر الرئيسي - قاعة الاجتماعات",
                btnPack: "تحميل حزمة الاجتماع",
                btnConfirm: "تأكيد الحضور",
                voteTitle: "قرارات تتطلب تصويتك",
                lblUrgent: "عاجل",
                voteSubject1: "تعيين مستشار قانوني للمجموعة",
                viewAttach: "عرض المرفقات",
                btnAgree: "موافق",
                btnDisagree: "غير موافق",
                btnAbstain: "ممتنع",
                myMemberships: "عضوياتي",
                libTitle: "المكتبة الرقمية",
                docBylaws: "النظام الأساسي",
                docGov: "لائحة الحوكمة",
                signTitle: "تأكيد التصويت والتوقيع",
                signDesc: "يرجى التوقيع أدناه لاعتماد تصويتك.",
                signHere: "ارسم توقيعك هنا",
                cancel: "إلغاء",
                btnConfirmSign: "اعتماد وتوقيع"
            },
            en: {
                pageTitle: "Leadership Portal",
                portalName: "Leadership Portal",
                ctxBoard: "Board of Directors",
                ctxAudit: "Audit Committee",
                roleSec: "Board Secretary",
                roleMember: "Board Member",
                welcome: "Welcome,",
                statusMsg: "Here is your summary and pending tasks.",
                secTools: "Secretary Tools",
                secPanelTitle: "Secretary Command Center",
                secNewMtg: "Invite New Meeting",
                secNewRes: "New Resolution",
                secUploadDocs: "Upload Draft Minutes",
                secRemind: "Remind Members",
                lblNextMtg: "Next Meeting",
                monthFeb: "February",
                mtgTitle: "Quarterly Board Meeting (Q1)",
                locHQ: "HQ - Boardroom",
                btnPack: "Download Meeting Pack",
                btnConfirm: "Confirm Attendance",
                voteTitle: "Decisions Requiring Your Vote",
                lblUrgent: "Urgent",
                voteSubject1: "Appoint Group Legal Advisor",
                viewAttach: "View Attachments",
                btnAgree: "Agree",
                btnDisagree: "Disagree",
                btnAbstain: "Abstain",
                myMemberships: "My Memberships",
                libTitle: "Digital Library",
                docBylaws: "Company Bylaws",
                docGov: "Governance Regulations",
                signTitle: "Confirm Vote & Sign",
                signDesc: "Please sign below to authorize your vote.",
                signHere: "Draw signature here",
                cancel: "Cancel",
                btnConfirmSign: "Confirm & Sign"
            }
        };
    </script>
</body>
</html>
