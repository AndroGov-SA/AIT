<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#FB4747">
    <title data-i18n="pageTitle">الهيكل التنظيمي | AndroGov</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { brandRed: '#FB4747', brandDark: '#0F172A' },
                    fontFamily: { sans: ['Tajawal', 'Inter', 'sans-serif'], en: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        .num-font { font-family: 'Inter', sans-serif; }
        
        /* Tree CSS Logic */
        .tree { white-space: nowrap; overflow-x: auto; padding: 20px; min-height: 500px; text-align: center; }
        .tree ul {
            padding-top: 20px; position: relative;
            transition: all 0.5s;
            display: flex; justify-content: center;
        }
        .tree li {
            float: left; text-align: center;
            list-style-type: none;
            position: relative;
            padding: 20px 10px 0 10px;
            transition: all 0.5s;
        }
        /* Connectors */
        .tree li::before, .tree li::after {
            content: ''; position: absolute; top: 0; right: 50%;
            border-top: 2px solid #ccc; width: 50%; height: 20px;
        }
        .tree li::after { right: auto; left: 50%; border-left: 2px solid #ccc; }
        .tree li:only-child::after, .tree li:only-child::before { display: none; }
        .tree li:only-child { padding-top: 0; }
        .tree li:first-child::before, .tree li:last-child::after { border: 0 none; }
        .tree li:last-child::before { border-right: 2px solid #ccc; border-radius: 0 5px 0 0; }
        .tree li:first-child::after { border-radius: 5px 0 0 0; }
        
        /* Vertical Connector for children */
        .tree ul ul::before {
            content: ''; position: absolute; top: 0; left: 50%;
            border-left: 2px solid #ccc; width: 0; height: 20px;
        }

        /* Node Card */
        .tree .node {
            display: inline-block;
            padding: 10px 15px;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            position: relative;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            min-width: 140px;
            max-width: 190px;
            white-space: normal;
        }
        .tree .node:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); z-index: 10; }

        /* Node Colors */
        .node-black { background: #1e293b; color: #fff; border: 2px solid #0f172a; } /* Board/CEO/GA */
        .node-gray { background: #f1f5f9; color: #334155; border: 2px dashed #94a3b8; } /* Committees */
        .node-blue { background: #eff6ff; color: #1e40af; border: 2px solid #3b82f6; } /* Executives */
        .node-purple { background: #f5f3ff; color: #5b21b6; border: 2px solid #8b5cf6; } /* Tech */
        .node-red { background: #fef2f2; color: #991b1b; border: 2px solid #ef4444; } /* Ops/Sales */
        .node-sub { background: #ffffff; color: #475569; border: 1px solid #cbd5e1; font-size: 0.75rem; } /* Sub-employees */
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 font-sans transition-colors duration-300 opacity-0">

    <div id="sidebar-container"></div>
    
    <div class="main-content-wrapper transition-all duration-300 flex flex-col min-h-screen">
        <div id="header-container"></div>

        <main class="p-6 space-y-6 flex-1 flex flex-col">
            
            <div class="flex justify-between items-end mb-4">
                <div>
                    <h1 class="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
                        <i class="fa-solid fa-sitemap text-brandRed"></i> 
                        <span data-i18n="headerTitle">الهيكل التنظيمي</span>
                    </h1>
                    <p class="text-sm text-slate-500 mt-1" data-i18n="headerDesc">التسلسل الإداري والوظيفي حسب أحدث تحديث</p>
                </div>
                <div class="flex gap-2">
                    <button class="px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-xs font-bold shadow-sm hover:bg-slate-50 transition">
                        <i class="fa-solid fa-print"></i> 
                        <span data-i18n="btnPrint">طباعة / PDF</span>
                    </button>
                </div>
            </div>

            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden flex-1 relative custom-scroll">
                
                <div class="absolute top-4 right-4 z-10 bg-white/90 dark:bg-slate-800/90 backdrop-blur p-3 rounded-lg border border-slate-100 dark:border-slate-600 text-xs shadow-lg">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="w-3 h-3 rounded bg-[#1e293b]"></span> 
                        <span data-i18n="legendTop">الإدارة العليا</span>
                    </div>
                    <div class="flex items-center gap-2 mb-1">
                        <span class="w-3 h-3 rounded bg-[#f1f5f9] border border-dashed border-slate-400"></span> 
                        <span data-i18n="legendAudit">لجان رقابية</span>
                    </div>
                    <div class="flex items-center gap-2 mb-1">
                        <span class="w-3 h-3 rounded bg-[#eff6ff] border border-blue-500"></span> 
                        <span data-i18n="legendExec">إدارة تنفيذية</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded bg-[#fef2f2] border border-red-500"></span> 
                        <span data-i18n="legendOps">تشغيل ومبيعات</span>
                    </div>
                </div>

                <!-- ==== ORG TREE (مطابق للصورة) ==== -->
                <div class="tree">
                    <ul>
                        <li>
                            <!-- Shareholders / General Assembly -->
                            <div class="node node-black" onclick="showNode('Shareholders', 'General Assembly')">
                                <span class="text-xs font-bold block">الجمعية العمومية للمساهمين</span>
                            </div>

                            <ul>
                                <li>
                                    <!-- Board of Directors -->
                                    <div class="node node-black" onclick="showNode('Board of Directors', 'Board')">
                                        <span class="text-xs font-bold block">مجلس الإدارة</span>
                                    </div>

                                    <!-- Children of Board: Audit Committee, Secretariat, CEO -->
                                    <ul>
                                        <!-- Audit Committee -> Internal Auditor -->
                                        <li>
                                            <div class="node node-gray" onclick="showNode('Audit Committee', 'Committee')">
                                                <span class="text-[10px] font-bold block">لجنة المراجعة</span>
                                            </div>
                                            <ul>
                                                <li>
                                                    <div class="node node-gray" onclick="showNode('Internal Auditor', 'Internal Audit')">
                                                        <span class="text-[10px] font-bold block">المراجع الداخلي</span>
                                                    </div>
                                                </li>
                                            </ul>
                                        </li>

                                        <!-- Secretariat -->
                                        <li>
                                            <div class="node node-gray" onclick="showNode('Secretariat', 'Secretariat')">
                                                <span class="text-[10px] font-bold block">أمانة سر المجلس</span>
                                            </div>
                                        </li>

                                        <!-- CEO and whole executive branch -->
                                        <li>
                                            <div class="node node-black" onclick="showNode('Hisham Al-Suhaibani', 'CEO')">
                                                <span class="text-xs font-bold block">الرئيس التنفيذي (CEO)</span>
                                            </div>

                                            <!-- Children of CEO: CFO, CAO, GRCO, NCSO -->
                                            <ul>
                                                <!-- CFO with PSSC + OS -->
                                                <li>
                                                    <div class="node node-blue" onclick="showNode('Mohammed Al-Bukhaiti', 'CFO')">
                                                        <span class="text-[10px] font-bold block">المدير المالي (CFO)</span>
                                                    </div>
                                                    <ul>
                                                        <li><div class="node node-sub">منسق المشتريات والخدمات الأمنية (PSSC)</div></li>
                                                        <li><div class="node node-sub">دعم المكاتب (OS)</div></li>
                                                    </ul>
                                                </li>

                                                <!-- CAO with Tech / Development / Medical -->
                                                <li>
                                                    <div class="node node-blue" onclick="showNode('Mansour Al-Yami', 'CAO')">
                                                        <span class="text-[10px] font-bold block">المدير الإداري (CAO)</span>
                                                    </div>
                                                    <ul>
                                                        <!-- Tech Team Leader -->
                                                        <li>
                                                            <div class="node node-purple" onclick="showNode('Tech Team Leader', 'Tech Lead')">
                                                                <span class="text-[10px] font-bold block">قائد الفريق التقني</span>
                                                            </div>
                                                            <ul>
                                                                <li><div class="node node-sub">Frontend Developer (React)</div></li>
                                                                <li><div class="node node-sub">Software Web Developer</div></li>
                                                                <li><div class="node node-sub">Mobile Developer</div></li>
                                                                <li><div class="node node-sub">Quality Assurance Engineer</div></li>
                                                            </ul>
                                                        </li>

                                                        <!-- Director of Development -->
                                                        <li>
                                                            <div class="node node-red" onclick="showNode('Director of Development', 'Development')">
                                                                <span class="text-[10px] font-bold block">مدير التطوير</span>
                                                            </div>
                                                            <ul>
                                                                <li><div class="node node-sub">Business Analyst</div></li>
                                                                <li><div class="node node-sub">Junior Business Analyst</div></li>
                                                                <li><div class="node node-sub">Software Developer</div></li>
                                                                <li><div class="node node-sub">Mobile Developer (Flutter)</div></li>
                                                                <li><div class="node node-sub">Quality Assurance Engineer</div></li>
                                                            </ul>
                                                        </li>

                                                        <!-- Medical Supervisor -->
                                                        <li>
                                                            <div class="node node-red" onclick="showNode('Medical Supervisor', 'MS')">
                                                                <span class="text-[10px] font-bold block">المشرف الطبي (MS)</span>
                                                            </div>
                                                            <ul>
                                                                <li><div class="node node-sub">Customer Accounts Manager (CAM)</div></li>
                                                                <li><div class="node node-sub">Operational & Technical Support Specialist (OSTS)</div></li>
                                                            </ul>
                                                        </li>
                                                    </ul>
                                                </li>

                                                <!-- GRCO -->
                                                <li>
                                                    <div class="node node-blue" onclick="showNode('Ayman Almaghrabi', 'GRCO')">
                                                        <span class="text-[10px] font-bold block">الحوكمة والمخاطر والالتزام (GRCO)</span>
                                                    </div>
                                                </li>

                                                <!-- NCSO -> Sales Manager & team -->
                                                <li>
                                                    <div class="node node-blue" onclick="showNode('Cybersecurity & Network Specialist', 'NCSO')">
                                                        <span class="text-[10px] font-bold block">أمن المعلومات والشبكات (NCSO)</span>
                                                    </div>
                                                    <ul>
                                                        <li>
                                                            <div class="node node-red" onclick="showNode('Sales Manager', 'Sales Manager')">
                                                                <span class="text-[10px] font-bold block">مدير المبيعات</span>
                                                            </div>
                                                            <ul>
                                                                <li><div class="node node-sub">Pre-sales Engineer</div></li>
                                                                <li><div class="node node-sub">Sales Specialist</div></li>
                                                                <li><div class="node node-sub">Digital Marketing Specialist</div></li>
                                                            </ul>
                                                        </li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>

                        </li>
                    </ul>
                </div>

                <!-- ممكن تضيف هنا الوصف النصّي لو حاب، زي ما عطيتك قبل -->

            </div>

        </main>
    </div>

    <!-- Modal -->
    <div id="nodeModal" class="fixed inset-0 bg-black/60 hidden z-50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white dark:bg-slate-800 w-full max-w-sm rounded-2xl shadow-xl p-6 text-center transform transition-all scale-100">
            <div class="w-20 h-20 rounded-full bg-slate-100 dark:bg-slate-700 mx-auto mb-4 overflow-hidden border-4 border-slate-50 dark:border-slate-600 shadow-lg">
                <img id="modalImg" src="" class="w-full h-full object-cover">
            </div>
            <h3 id="modalName" class="text-xl font-bold text-slate-900 dark:text-white mb-1"></h3>
            <p id="modalRole" class="text-sm text-brandRed font-medium mb-4"></p>
            
            <div class="flex justify-center gap-2 mb-6">
                <button class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 hover:text-brandRed hover:bg-red-50 transition">
                    <i class="fa-regular fa-envelope"></i>
                </button>
                <button class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 hover:text-brandRed hover:bg-red-50 transition">
                    <i class="fa-solid fa-phone"></i>
                </button>
            </div>

            <button onclick="document.getElementById('nodeModal').classList.add('hidden')" class="w-full py-2 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-white rounded-lg text-sm font-bold hover:bg-slate-200 dark:hover:bg-slate-600 transition" data-i18n="btnClose">إغلاق</button>
        </div>
    </div>

    <script src="layout-hr.js"></script>
    <script src="bot.js"></script>

    <script>
        // --- 1. الترجمة ---
        const pageContent = {
            ar: {
                pageTitle: "الهيكل التنظيمي | AndroGov",
                headerTitle: "الهيكل التنظيمي",
                headerDesc: "التسلسل الإداري والوظيفي حسب أحدث تحديث",
                btnPrint: "طباعة / PDF",
                legendTop: "الإدارة العليا",
                legendAudit: "لجان رقابية",
                legendExec: "إدارة تنفيذية",
                legendOps: "تشغيل ومبيعات",
                btnClose: "إغلاق"
            },
            en: {
                pageTitle: "Org Chart | AndroGov",
                headerTitle: "Organizational Chart",
                headerDesc: "Administrative and Functional Hierarchy",
                btnPrint: "Print / PDF",
                legendTop: "Top Management",
                legendAudit: "Control Committees",
                legendExec: "Executive Management",
                legendOps: "Operations & Sales",
                btnClose: "Close"
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            updatePageLanguage();
        });

        function updatePageLanguage() {
            const lang = localStorage.getItem('lang') || 'ar';
            const dict = pageContent[lang];
            
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (dict[key]) el.innerText = dict[key];
            });
        }

        function showNode(name, role) {
            document.getElementById('modalName').innerText = name;
            document.getElementById('modalRole').innerText = role;
            document.getElementById('modalImg').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=random&size=128`;
            document.getElementById('nodeModal').classList.remove('hidden');
        }
    </script>
</body>
</html>
