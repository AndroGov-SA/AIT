<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#FB4747">
    <title data-i18n="pageTitle">الهيكل التنظيمي | AndroGov</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { brandRed: '#FB4747', brandDark: '#0F172A' },
                    fontFamily: { sans: ['Tajawal', 'Inter', 'sans-serif'], en: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        .num-font { font-family: 'Inter', sans-serif; }
        
        /* Tree CSS Logic */
        .tree { white-space: nowrap; overflow-x: auto; padding: 20px; min-height: 500px; text-align: center; }
        .tree ul {
            padding-top: 20px; position: relative;
            transition: all 0.5s;
            display: flex; justify-content: center;
        }
        .tree li {
            float: left; text-align: center;
            list-style-type: none;
            position: relative;
            padding: 20px 10px 0 10px;
            transition: all 0.5s;
        }
        /* Connectors */
        .tree li::before, .tree li::after {
            content: ''; position: absolute; top: 0; right: 50%;
            border-top: 2px solid #ccc; width: 50%; height: 20px;
        }
        .tree li::after { right: auto; left: 50%; border-left: 2px solid #ccc; }
        .tree li:only-child::after, .tree li:only-child::before { display: none; }
        .tree li:only-child { padding-top: 0; }
        .tree li:first-child::before, .tree li:last-child::after { border: 0 none; }
        .tree li:last-child::before { border-right: 2px solid #ccc; border-radius: 0 5px 0 0; }
        .tree li:first-child::after { border-radius: 5px 0 0 0; }
        
        /* Node Card */
        .tree .node {
            display: inline-block;
            padding: 10px 15px;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            position: relative;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            min-width: 140px;
            max-width: 180px;
            white-space: normal;
        }
        .tree .node:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); z-index: 10; }
        .tree ul ul::before {
            content: ''; position: absolute; top: 0; left: 50%;
            border-left: 2px solid #ccc; width: 0; height: 20px;
        }

        /* Node Colors (Based on Image) */
        .node-black { background: #000; color: #fff; border: 2px solid #000; }
        .node-gray { background: #E2E8F0; color: #1E293B; border: 2px solid #94A3B8; }
        .node-blue { background: #3B82F6; color: #fff; border: 2px solid #2563EB; }
        .node-purple { background: #8B5CF6; color: #fff; border: 2px solid #7C3AED; }
        .node-red { background: #EF4444; color: #fff; border: 2px solid #DC2626; }
        .node-white-blue { background: #fff; color: #1E293B; border: 2px solid #3B82F6; }
        .node-white-red { background: #fff; color: #1E293B; border: 2px solid #EF4444; }
        .node-white-purple { background: #fff; color: #1E293B; border: 2px solid #8B5CF6; }

        /* Dashed Line Logic for Advisory Roles */
        .dashed-connector { border-top: 2px dashed #94A3B8 !important; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 font-sans transition-colors duration-300 opacity-0">

    <div id="sidebar-container"></div>
    
    <div class="main-content-wrapper transition-all duration-300 flex flex-col min-h-screen">
        <div id="header-container"></div>

        <main class="p-6 space-y-6 flex-1 flex flex-col">
            
            <div class="flex justify-between items-end mb-4">
                <div>
                    <h1 class="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
                        <i class="fa-solid fa-sitemap text-brandRed"></i> <span data-i18n="headerTitle">الهيكل التنظيمي</span>
                    </h1>
                    <p class="text-sm text-slate-500 mt-1" data-i18n="headerDesc">استعراض الهيكل الإداري والوظيفي للشركة</p>
                </div>
                <div class="flex gap-2">
                    <button class="px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-xs font-bold shadow-sm hover:bg-slate-50 transition">
                        <i class="fa-solid fa-print"></i> <span data-i18n="btnPrint">طباعة / PDF</span>
                    </button>
                </div>
            </div>

            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden flex-1 relative custom-scroll">
                
                <div class="absolute top-4 right-4 z-10 bg-white/80 dark:bg-slate-800/80 backdrop-blur p-2 rounded-lg border dark:border-slate-600 text-xs">
                    <div class="flex items-center gap-2 mb-1"><span class="w-3 h-3 rounded-full bg-black"></span> <span data-i18n="legendTop">الإدارة العليا</span></div>
                    <div class="flex items-center gap-2 mb-1"><span class="w-3 h-3 rounded-full bg-blue-500"></span> <span data-i18n="legendExec">التنفيذيين</span></div>
                    <div class="flex items-center gap-2 mb-1"><span class="w-3 h-3 rounded-full bg-red-500"></span> <span data-i18n="legendOps">التشغيل والتطوير</span></div>
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-purple-500"></span> <span data-i18n="legendTech">التقنية</span></div>
                </div>

                <div class="tree">
                    <ul>
                        <li>
                            <div class="node node-black" onclick="showNode('Shareholders', 'General Assembly')">
                                <span class="text-xs font-bold block" data-i18n="nodeShareholders">الجمعية العمومية</span>
                            </div>
                            <ul>
                                <li>
                                    <div class="node node-black" onclick="showNode('Board of Directors', 'Chairman')">
                                        <span class="text-xs font-bold block" data-i18n="nodeBoard">مجلس الإدارة</span>
                                    </div>
                                    <ul>
                                        <li>
                                            <div class="node node-black" onclick="showNode('Hisham Al-Suhaibani', 'CEO')">
                                                <span class="text-xs font-bold block" data-i18n="nodeCEO">الرئيس التنفيذي (CEO)</span>
                                            </div>
                                            
                                            <ul>
                                                <li>
                                                    <div class="node node-white-blue" onclick="showNode('Employee', 'PSSC')">
                                                        <span class="text-[10px] font-bold block" data-i18n="nodePSSC">منسق المشتريات والأمن</span>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="node node-blue" onclick="showNode('Mohammed Al-Bukhaiti', 'CFO')">
                                                        <span class="text-[10px] font-bold block" data-i18n="nodeCFO">المدير المالي (CFO)</span>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="node node-blue ring-4 ring-yellow-400/50" onclick="showNode('Mansour Al-Yami', 'CAO')">
                                                        <span class="text-[10px] font-bold block" data-i18n="nodeCAO">المدير الإداري (CAO)</span>
                                                    </div>
                                                    <ul>
                                                        <li>
                                                            <div class="node node-white-blue" onclick="showNode('Support Team', 'Office Support')">
                                                                <span class="text-[10px] font-bold block" data-i18n="nodeOS">دعم المكاتب (OS)</span>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </li>
                                                <li>
                                                    <div class="node node-blue" onclick="showNode('Ayman Almaghrabi', 'GRCO')">
                                                        <span class="text-[10px] font-bold block" data-i18n="nodeGRCO">الحوكمة والمخاطر (GRCO)</span>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="node node-blue" onclick="showNode('Security Team', 'NCSO')">
                                                        <span class="text-[10px] font-bold block" data-i18n="nodeNCSO">الأمن السيبراني (NCSO)</span>
                                                    </div>
                                                </li>
                                            </ul>

                                            <ul style="padding-top: 40px; border-top: 2px dashed #cbd5e1; margin-top: 20px;">
                                                <li>
                                                    <div class="node node-purple" onclick="showNode('Tech Lead', 'Team Leader')">
                                                        <span class="text-[10px] font-bold block" data-i18n="nodeTechLead">قائد الفريق التقني</span>
                                                    </div>
                                                    <ul>
                                                        <li><div class="node node-white-purple"><span data-i18n="nodeFrontend">Frontend</span></div></li>
                                                        <li><div class="node node-white-purple"><span data-i18n="nodeBackend">Backend</span></div></li>
                                                        <li><div class="node node-white-purple"><span data-i18n="nodeMobile">Mobile</span></div></li>
                                                        <li><div class="node node-white-purple"><span data-i18n="nodeQA">QA Engineer</span></div></li>
                                                    </ul>
                                                </li>
                                                <li>
                                                    <div class="node node-red" onclick="showNode('Director', 'Development')">
                                                        <span class="text-[10px] font-bold block" data-i18n="nodeDevDir">مدير التطوير</span>
                                                    </div>
                                                    <ul>
                                                        <li><div class="node node-white-red"><span data-i18n="nodeBA">Business Analyst</span></div></li>
                                                        <li><div class="node node-white-red"><span data-i18n="nodeSoftDev">Software Dev</span></div></li>
                                                    </ul>
                                                </li>
                                                <li>
                                                    <div class="node node-red" onclick="showNode('Medical Sup', 'Medical')">
                                                        <span class="text-[10px] font-bold block" data-i18n="nodeMedSup">المشرف الطبي</span>
                                                    </div>
                                                    <ul>
                                                        <li><div class="node node-white-red"><span data-i18n="nodeCAM">Customer Accounts</span></div></li>
                                                    </ul>
                                                </li>
                                                <li>
                                                    <div class="node node-red" onclick="showNode('Sales Mgr', 'Sales')">
                                                        <span class="text-[10px] font-bold block" data-i18n="nodeSalesMgr">مدير المبيعات</span>
                                                    </div>
                                                    <ul>
                                                        <li><div class="node node-white-red"><span data-i18n="nodePreSales">Pre-sales</span></div></li>
                                                        <li><div class="node node-white-red"><span data-i18n="nodeMarketing">Digital Marketing</span></div></li>
                                                    </ul>
                                                </li>
                                            </ul>

                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>

        </main>
    </div>

    <div id="nodeModal" class="fixed inset-0 bg-black/60 hidden z-50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white dark:bg-slate-800 w-full max-w-sm rounded-2xl shadow-xl p-6 text-center transform transition-all scale-100">
            <div class="w-20 h-20 rounded-full bg-slate-100 dark:bg-slate-700 mx-auto mb-4 overflow-hidden border-4 border-slate-50 dark:border-slate-600 shadow-lg">
                <img id="modalImg" src="" class="w-full h-full object-cover">
            </div>
            <h3 id="modalName" class="text-xl font-bold text-slate-900 dark:text-white mb-1"></h3>
            <p id="modalRole" class="text-sm text-brandRed font-medium mb-4"></p>
            
            <div class="flex justify-center gap-2 mb-6">
                <button class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 hover:text-brandRed hover:bg-red-50 transition"><i class="fa-regular fa-envelope"></i></button>
                <button class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 hover:text-brandRed hover:bg-red-50 transition"><i class="fa-solid fa-phone"></i></button>
                <button class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 hover:text-brandRed hover:bg-red-50 transition"><i class="fa-brands fa-whatsapp"></i></button>
            </div>

            <button onclick="document.getElementById('nodeModal').classList.add('hidden')" class="w-full py-2 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-white rounded-lg text-sm font-bold hover:bg-slate-200 dark:hover:bg-slate-600 transition" data-i18n="btnClose">إغلاق</button>
        </div>
    </div>

    <script src="layout-hr.js"></script>
    <script src="bot.js"></script>

    <script>
        // --- 1. الترجمة ---
        const pageContent = {
            ar: {
                pageTitle: "الهيكل التنظيمي | AndroGov",
                headerTitle: "الهيكل التنظيمي",
                headerDesc: "استعراض الهيكل الإداري والوظيفي للشركة",
                btnPrint: "طباعة / PDF",
                legendTop: "الإدارة العليا",
                legendExec: "التنفيذيين",
                legendOps: "التشغيل والتطوير",
                legendTech: "التقنية",
                nodeShareholders: "الجمعية العمومية للمساهمين",
                nodeBoard: "مجلس الإدارة",
                nodeCEO: "الرئيس التنفيذي (CEO)",
                nodeCFO: "المدير المالي (CFO)",
                nodeCAO: "المدير الإداري (CAO)",
                nodeGRCO: "الحوكمة والمخاطر (GRCO)",
                nodeNCSO: "الأمن السيبراني (NCSO)",
                nodePSSC: "منسق المشتريات والأمن (PSSC)",
                nodeOS: "دعم المكاتب (OS)",
                nodeTechLead: "قائد الفريق التقني",
                nodeFrontend: "Frontend Dev",
                nodeBackend: "Web Developer",
                nodeMobile: "Mobile Dev",
                nodeQA: "QA Engineer",
                nodeDevDir: "مدير التطوير",
                nodeBA: "Business Analyst",
                nodeSoftDev: "Software Dev",
                nodeMedSup: "المشرف الطبي",
                nodeCAM: "مدير حسابات العملاء",
                nodeSalesMgr: "مدير المبيعات",
                nodePreSales: "Pre-sales Eng",
                nodeMarketing: "التسويق الرقمي",
                btnClose: "إغلاق"
            },
            en: {
                pageTitle: "Org Chart | AndroGov",
                headerTitle: "Organizational Chart",
                headerDesc: "Company Hierarchy and Functional Structure",
                btnPrint: "Print / PDF",
                legendTop: "Top Management",
                legendExec: "Executives",
                legendOps: "Ops & Dev",
                legendTech: "Technology",
                nodeShareholders: "Shareholders Assembly",
                nodeBoard: "Board of Directors",
                nodeCEO: "Chief Executive Officer (CEO)",
                nodeCFO: "Chief Financial Officer (CFO)",
                nodeCAO: "Chief Admin Officer (CAO)",
                nodeGRCO: "Governance & Risk (GRCO)",
                nodeNCSO: "Cybersecurity (NCSO)",
                nodePSSC: "Procurement & Security (PSSC)",
                nodeOS: "Office Support (OS)",
                nodeTechLead: "Tech Team Leader",
                nodeFrontend: "Frontend Dev",
                nodeBackend: "Web Developer",
                nodeMobile: "Mobile Dev",
                nodeQA: "QA Engineer",
                nodeDevDir: "Director of Development",
                nodeBA: "Business Analyst",
                nodeSoftDev: "Software Dev",
                nodeMedSup: "Medical Supervisor",
                nodeCAM: "Customer Accounts Mgr",
                nodeSalesMgr: "Sales Manager",
                nodePreSales: "Pre-sales Eng",
                nodeMarketing: "Digital Marketing",
                btnClose: "Close"
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            updatePageLanguage();
        });

        function updatePageLanguage() {
            const lang = localStorage.getItem('lang') || 'ar';
            const dict = pageContent[lang];
            
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(dict[key]) el.innerText = dict[key];
            });
        }

        function showNode(name, role) {
            document.getElementById('modalName').innerText = name;
            document.getElementById('modalRole').innerText = role;
            document.getElementById('modalImg').src = `https://ui-avatars.com/api/?name=${name}&background=random&size=128`;
            document.getElementById('nodeModal').classList.remove('hidden');
        }
    </script>
</body>
</html>
